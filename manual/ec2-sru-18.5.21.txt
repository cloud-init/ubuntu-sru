#!/bin/sh

set -e

# Manual EC2 upgrade and clean install validation Xenial and Bionic
cat > sethostname.yaml <<EOF
## template: jinja
#cloud-config
ssh_import_id: [chad.smith]
hostname: SRU-worked-{{v1.cloud_name}}
EOF

cat > setup_proposed.sh <<EOF
#/bin/bash
mirror=http://archive.ubuntu.com/ubuntu
echo deb \$mirror \$(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q;
apt-get install -qy cloud-init;
EOF

# set -x outputs each commant to standard error, so an easy way to keen an eye
# what's going on while saving a clean log file (stdout only) is using tee(1).
set -x

for SERIES in xenial bionic cosmic; do
    echo "### BEGIN $SERIES"
    EC2_INST=`launch-ec2 --series $SERIES -u sethostname.yaml | awk '/Found/{print $5}'`
    sleep 60
    ssh $sshopts $EC2_INST -- cloud-init status --wait --long
    ssh $sshopts $EC2_INST -- cat /run/cloud-init/result.json
    ssh $sshopts $EC2_INST -- ! grep Trace "/var/log/cloud-init.*"
    ssh $sshopts $EC2_INST -- sudo systemd-analyze
    ssh $sshopts $EC2_INST -- sudo systemd-analyze blame
    ssh $sshopts $EC2_INST -- sudo cloud-init analyze show
    ssh $sshopts $EC2_INST -- ! sudo grep Trace "/var/log/cloud-init*"
    scp $sshopts setup_proposed.sh $EC2_INST:
    ssh $sshopts $EC2_INST sudo bash ./setup_proposed.sh 2>&1 | egrep 'cloud-init'
    ssh $sshopts $EC2_INST sudo hostname something-else
    ssh $sshopts $EC2_INST -- sudo cloud-init init
    ssh $sshopts $EC2_INST -- ! grep Trace "/var/log/cloud-init*"
    ssh $sshopts $EC2_INST -- sudo cloud-init clean --logs --reboot || true
    sleep 60
    date --utc +%s.%N
    ssh $sshopts $EC2_INST -- cloud-init status --wait --long; date --utc +%s.%N
    ssh $sshopts $EC2_INST -- hostname
    ssh $sshopts $EC2_INST -- ! grep Trace "/var/log/cloud-init*"
    ssh $sshopts $EC2_INST -- sudo systemd-analyze
    ssh $sshopts $EC2_INST -- sudo cloud-init analyze show
    if [ "$SERIES" = "xenial" ]; then
       echo "--- Expect warning on xenial for jinja because deb DOES NOT have jinja dep."
    else
       echo "--- Expect success on bionic for jinja because deb DOES have jinja dep."
    fi
    ssh $sshopts $EC2_INST "cloud-init query --format 'cloud-region: {{cloud_name}}-{{region}}'"
    
    echo 'Per LP:1794399 expect we do not see a lot of killing dhclient logs'
    ssh $sshopts $EC2_INST "grep dhclient /var/log/cloud-init.log"
    
    echo 'Get cloud-id'
    ssh $sshopts $EC2_INST cloud-id
    echo "### END $SERIES"
done

### BEGIN xenial
.................
status: done
time: Thu, 14 Feb 2019 21:04:21 +0000
detail:
DataSourceEc2Local
{
 "v1": {
  "datasource": "DataSourceEc2Local",
  "errors": []
 }
}
Startup finished in 4.055s (kernel) + 18.196s (userspace) = 22.251s
          8.447s snapd.seeded.service
          3.616s cloud-init-local.service
          3.526s dev-xvda1.device
          3.094s console-setup.service
          2.667s apparmor.service
          2.531s cloud-config.service
          1.825s snapd.service
          1.010s pollinate.service
           976ms cloud-init.service
           583ms cloud-final.service
           497ms lvm2-monitor.service
           408ms resolvconf.service
           395ms systemd-modules-load.service
           362ms systemd-update-utmp.service
           352ms iscsid.service
           320ms systemd-timesyncd.service
           309ms accounts-daemon.service
           301ms dev-hugepages.mount
           300ms systemd-remount-fs.service
           291ms kmod-static-nodes.service
           275ms sys-kernel-debug.mount
           273ms keyboard-setup.service
           271ms mdadm.service
           267ms lxd-containers.service
           263ms dev-mqueue.mount
           262ms grub-common.service
           192ms systemd-logind.service
           143ms rc-local.service
           142ms rsyslog.service
           138ms networking.service
           135ms systemd-journald.service
           132ms apport.service
           130ms irqbalance.service
           116ms ufw.service
           116ms systemd-udev-trigger.service
            94ms systemd-journal-flush.service
            75ms ondemand.service
            62ms systemd-tmpfiles-setup-dev.service
            60ms systemd-random-seed.service
            59ms open-iscsi.service
            55ms plymouth-read-write.service
            55ms systemd-machine-id-commit.service
            54ms systemd-tmpfiles-setup.service
            46ms polkitd.service
            45ms systemd-user-sessions.service
            40ms snap-amazon\x2dssm\x2dagent-930.mount
            35ms systemd-sysctl.service
            34ms ssh.service
            31ms sys-fs-fuse-connections.mount
            28ms plymouth-quit-wait.service
            28ms snap-core-6350.mount
            28ms setvtrgb.service
            26ms lxd.socket
            25ms user@1000.service
            24ms plymouth-quit.service
            24ms systemd-update-utmp-runlevel.service
            23ms systemd-udevd.service
            21ms snapd.socket
            18ms dev-loop1.device
            17ms dev-loop0.device
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.01600s +00.00100s
|`->no local data found from DataSourceNoCloud @00.15200s +00.15400s
|`->no local data found from DataSourceConfigDrive @00.30700s +00.19600s
|`->no local data found from DataSourceOpenNebula @00.50300s +00.12400s
|`->no local data found from DataSourceDigitalOcean @00.62700s +00.03300s
|`->no local data found from DataSourceAzure @00.66000s +00.01500s
|`->no local data found from DataSourceOVF @00.67500s +00.06400s
|`->no local data found from DataSourceOpenStackLocal @00.73900s +00.04800s
|`->no local data found from DataSourceCloudSigma @00.78700s +00.01300s
|`->no local data found from DataSourceSmartOS @00.80100s +00.02200s
|`->no local data found from DataSourceScaleway @00.82300s +00.01400s
|`->found local data from DataSourceEc2Local @00.83700s +01.20600s
Finished stage: (init-local) 02.11700 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceEc2Local @02.65700s +00.00400s
|`->setting up datasource @02.72200s +00.00000s
|`->reading and applying user-data @02.72900s +00.00700s
|`->reading and applying vendor-data @02.73700s +00.00000s
|`->activating datasource @02.76600s +00.00200s
|`->config-migrator ran successfully @02.78300s +00.00000s
|`->config-seed_random ran successfully @02.78400s +00.00100s
|`->config-bootcmd ran successfully @02.78500s +00.00000s
|`->config-write-files ran successfully @02.78500s +00.00100s
|`->config-growpart ran successfully @02.78600s +00.04300s
|`->config-resizefs ran successfully @02.82900s +00.01500s
|`->config-disk_setup ran successfully @02.84400s +00.00100s
|`->config-mounts ran successfully @02.84500s +00.00200s
|`->config-set_hostname ran successfully @02.84700s +00.00400s
|`->config-update_hostname ran successfully @02.85200s +00.00100s
|`->config-update_etc_hosts ran successfully @02.85300s +00.00000s
|`->config-ca-certs ran successfully @02.85400s +00.00000s
|`->config-rsyslog ran successfully @02.85500s +00.00000s
|`->config-users-groups ran successfully @02.85600s +00.07500s
|`->config-ssh ran successfully @02.93100s +00.28500s
Finished stage: (init-network) 00.57100 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @13.33400s +00.00100s
|`->config-snap ran successfully @13.33500s +00.00100s
|`->config-snap_config ran successfully @13.33600s +00.00100s
|`->config-ssh-import-id ran successfully @13.33700s +00.70400s
|`->config-locale ran successfully @14.04200s +00.73900s
|`->config-set-passwords ran successfully @14.78100s +00.00100s
|`->config-grub-dpkg ran successfully @14.78300s +00.14500s
|`->config-apt-pipelining ran successfully @14.92900s +00.00100s
|`->config-apt-configure ran successfully @14.93100s +00.09200s
|`->config-ubuntu-advantage ran successfully @15.02300s +00.00100s
|`->config-ntp ran successfully @15.02400s +00.00100s
|`->config-timezone ran successfully @15.02500s +00.00100s
|`->config-disable-ec2-metadata ran successfully @15.02600s +00.00000s
|`->config-runcmd ran successfully @15.02700s +00.00000s
|`->config-byobu ran successfully @15.02700s +00.00100s
Finished stage: (modules-config) 01.76000 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @15.42500s +00.00100s
|`->config-package-update-upgrade-install ran successfully @15.42700s +00.00000s
|`->config-fan ran successfully @15.42800s +00.00000s
|`->config-landscape ran successfully @15.42900s +00.00000s
|`->config-lxd ran successfully @15.43000s +00.00000s
|`->config-puppet ran successfully @15.43100s +00.00000s
|`->config-chef ran successfully @15.43200s +00.00000s
|`->config-mcollective ran successfully @15.43300s +00.00000s
|`->config-salt-minion ran successfully @15.43300s +00.00100s
|`->config-rightscale_userdata ran successfully @15.43400s +00.00100s
|`->config-scripts-vendor ran successfully @15.43500s +00.00100s
|`->config-scripts-per-once ran successfully @15.43600s +00.00100s
|`->config-scripts-per-boot ran successfully @15.43700s +00.00000s
|`->config-scripts-per-instance ran successfully @15.43800s +00.00000s
|`->config-scripts-user ran successfully @15.43900s +00.00000s
|`->config-ssh-authkey-fingerprints ran successfully @15.44000s +00.05300s
|`->config-keys-to-console ran successfully @15.49400s +00.10000s
|`->config-phone-home ran successfully @15.59500s +00.00100s
|`->config-final-message ran successfully @15.59600s +00.00400s
|`->config-power-state-change ran successfully @15.60100s +00.00000s
Finished stage: (modules-final) 00.19400 seconds 

Total Time: 4.64200 seconds

1 boot records analyzed
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 18.5-21-g8ee294d5-0ubuntu1~16.04.1 [392 kB]
Preparing to unpack .../cloud-init_18.5-21-g8ee294d5-0ubuntu1~16.04.1_all.deb ...
Unpacking cloud-init (18.5-21-g8ee294d5-0ubuntu1~16.04.1) over (18.4-0ubuntu1~16.04.2) ...
Setting up cloud-init (18.5-21-g8ee294d5-0ubuntu1~16.04.1) ...
Installing new version of config file /etc/bash_completion.d/cloud-init ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'
Cloud-init v. 18.5-21-g8ee294d5-0ubuntu1~16.04.1 running 'init' at Thu, 14 Feb 2019 21:04:41 +0000. Up 42.16 seconds.
ci-info: ++++++++++++++++++++++++++++++++++++++Net device info+++++++++++++++++++++++++++++++++++++++
ci-info: +--------+------+-----------------------------+---------------+--------+-------------------+
ci-info: | Device |  Up  |           Address           |      Mask     | Scope  |     Hw-Address    |
ci-info: +--------+------+-----------------------------+---------------+--------+-------------------+
ci-info: |  eth0  | True |         10.41.41.248        | 255.255.255.0 | global | 06:e7:c3:1a:72:0a |
ci-info: |  eth0  | True | fe80::4e7:c3ff:fe1a:720a/64 |       .       |  link  | 06:e7:c3:1a:72:0a |
ci-info: |   lo   | True |          127.0.0.1          |   255.0.0.0   |  host  |         .         |
ci-info: |   lo   | True |           ::1/128           |       .       |  host  |         .         |
ci-info: +--------+------+-----------------------------+---------------+--------+-------------------+
ci-info: ++++++++++++++++++++++++++++Route IPv4 info+++++++++++++++++++++++++++++
ci-info: +-------+-------------+------------+---------------+-----------+-------+
ci-info: | Route | Destination |  Gateway   |    Genmask    | Interface | Flags |
ci-info: +-------+-------------+------------+---------------+-----------+-------+
ci-info: |   0   |   0.0.0.0   | 10.41.41.1 |    0.0.0.0    |    eth0   |   UG  |
ci-info: |   1   |  10.41.41.0 |  0.0.0.0   | 255.255.255.0 |    eth0   |   U   |
ci-info: +-------+-------------+------------+---------------+-----------+-------+
ci-info: +++++++++++++++++++Route IPv6 info+++++++++++++++++++
ci-info: +-------+-------------+---------+-----------+-------+
ci-info: | Route | Destination | Gateway | Interface | Flags |
ci-info: +-------+-------------+---------+-----------+-------+
ci-info: |   0   |  fe80::/64  |    ::   |    eth0   |   U   |
ci-info: |   4   |   ff00::/8  |    ::   |    eth0   |   U   |
ci-info: +-------+-------------+---------+-----------+-------+
1550178288.294808430

status: done
time: Thu, 14 Feb 2019 21:05:19 +0000
detail:
DataSourceEc2Local
1550178321.116866384
SRU-worked-aws
Startup finished in 4.030s (kernel) + 9.947s (userspace) = 13.977s
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.01300s +00.00000s
|`->no local data found from DataSourceNoCloud @00.15800s +00.10700s
|`->no local data found from DataSourceConfigDrive @00.26500s +00.12700s
|`->no local data found from DataSourceOpenNebula @00.39200s +00.08900s
|`->no local data found from DataSourceDigitalOcean @00.48100s +00.01000s
|`->no local data found from DataSourceAzure @00.49200s +00.01200s
|`->no local data found from DataSourceOVF @00.50400s +00.04600s
|`->no local data found from DataSourceOpenStackLocal @00.55000s +00.03700s
|`->no local data found from DataSourceCloudSigma @00.58700s +00.01000s
|`->no local data found from DataSourceSmartOS @00.59700s +00.01300s
|`->no local data found from DataSourceScaleway @00.61000s +00.01400s
|`->found local data from DataSourceEc2Local @00.62400s +01.04700s
Finished stage: (init-local) 01.74700 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceEc2Local @02.28400s +00.00300s
|`->setting up datasource @02.35000s +00.00000s
|`->reading and applying user-data @02.35700s +00.00800s
|`->reading and applying vendor-data @02.36500s +00.00000s
|`->activating datasource @02.39500s +00.00100s
|`->config-migrator ran successfully @02.41200s +00.00000s
|`->config-seed_random ran successfully @02.41300s +00.00000s
|`->config-bootcmd ran successfully @02.41400s +00.00000s
|`->config-write-files ran successfully @02.41400s +00.00100s
|`->config-growpart ran successfully @02.41500s +00.04300s
|`->config-resizefs ran successfully @02.45800s +00.01400s
|`->config-disk_setup ran successfully @02.47300s +00.00000s
|`->config-mounts ran successfully @02.47400s +00.00100s
|`->config-set_hostname ran successfully @02.47500s +00.00400s
|`->config-update_hostname ran successfully @02.48000s +00.00100s
|`->config-update_etc_hosts ran successfully @02.48100s +00.00100s
|`->config-ca-certs ran successfully @02.48200s +00.00100s
|`->config-rsyslog ran successfully @02.48300s +00.00100s
|`->config-users-groups ran successfully @02.48400s +00.01300s
|`->config-ssh ran successfully @02.49700s +00.24400s
Finished stage: (init-network) 00.47100 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @05.38200s +00.00000s
|`->config-snap ran successfully @05.38300s +00.00000s
|`->config-snap_config ran successfully @05.38400s +00.00000s
|`->config-ssh-import-id ran successfully @05.38500s +00.72700s
|`->config-locale ran successfully @06.11300s +00.00100s
|`->config-set-passwords ran successfully @06.11500s +00.00000s
|`->config-grub-dpkg ran successfully @06.11600s +00.17300s
|`->config-apt-pipelining ran successfully @06.29000s +00.00200s
|`->config-apt-configure ran successfully @06.29200s +00.09100s
|`->config-ubuntu-advantage ran successfully @06.38400s +00.00100s
|`->config-ntp ran successfully @06.38500s +00.00100s
|`->config-timezone ran successfully @06.38600s +00.00100s
|`->config-disable-ec2-metadata ran successfully @06.38700s +00.00000s
|`->config-runcmd ran successfully @06.38700s +00.00100s
|`->config-byobu ran successfully @06.38800s +00.00100s
Finished stage: (modules-config) 01.02400 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @06.81400s +00.01000s
|`->config-package-update-upgrade-install ran successfully @06.82400s +00.00100s
|`->config-fan ran successfully @06.82500s +00.00100s
|`->config-landscape ran successfully @06.82600s +00.00400s
|`->config-lxd ran successfully @06.83000s +00.00900s
|`->config-puppet ran successfully @06.83900s +00.00100s
|`->config-chef ran successfully @06.84000s +00.00100s
|`->config-mcollective ran successfully @06.84100s +00.00100s
|`->config-salt-minion ran successfully @06.84200s +00.01100s
|`->config-rightscale_userdata ran successfully @06.85300s +00.00100s
|`->config-scripts-vendor ran successfully @06.85400s +00.00500s
|`->config-scripts-per-once ran successfully @06.85900s +00.00100s
|`->config-scripts-per-boot ran successfully @06.86000s +00.00000s
|`->config-scripts-per-instance ran successfully @06.86000s +00.00100s
|`->config-scripts-user ran successfully @06.86100s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @06.86800s +00.10700s
|`->config-keys-to-console ran successfully @06.97500s +00.13900s
|`->config-phone-home ran successfully @07.11500s +00.00100s
|`->config-final-message ran successfully @07.11600s +00.00800s
|`->config-power-state-change ran successfully @07.12500s +00.00000s
Finished stage: (modules-final) 00.33300 seconds 

Total Time: 3.57500 seconds

1 boot records analyzed
--- Expect warning on xenial for jinja because deb DOES NOT have jinja dep.
cloud-region: aws-us-east-2
Per LP:1794399 expect we do not see a lot of killing dhclient logs
2019-02-14 21:05:14,252 - util.py[DEBUG]: Copying /sbin/dhclient to /var/tmp/cloud-init/cloud-init-dhcp-1ht5jsag/dhclient
2019-02-14 21:05:14,258 - util.py[DEBUG]: Running command ['/var/tmp/cloud-init/cloud-init-dhcp-1ht5jsag/dhclient', '-1', '-v', '-lf', '/var/tmp/cloud-init/cloud-init-dhcp-1ht5jsag/dhcp.leases', '-pf', '/var/tmp/cloud-init/cloud-init-dhcp-1ht5jsag/dhclient.pid', 'eth0', '-sf', '/bin/true'] with allowed return codes [0] (shell=False, capture=True)
2019-02-14 21:05:14,277 - util.py[DEBUG]: All files appeared after 0 seconds: ['/var/tmp/cloud-init/cloud-init-dhcp-1ht5jsag/dhclient.pid', '/var/tmp/cloud-init/cloud-init-dhcp-1ht5jsag/dhcp.leases']
2019-02-14 21:05:14,278 - util.py[DEBUG]: Reading from /var/tmp/cloud-init/cloud-init-dhcp-1ht5jsag/dhclient.pid (quiet=False)
2019-02-14 21:05:14,278 - util.py[DEBUG]: Read 4 bytes from /var/tmp/cloud-init/cloud-init-dhcp-1ht5jsag/dhclient.pid
2019-02-14 21:05:14,278 - dhcp.py[DEBUG]: killing dhclient with pid=816
Get cloud-id
aws
### END xenial
### BEGIN bionic

status: done
time: Thu, 14 Feb 2019 21:19:43 +0000
detail:
DataSourceEc2Local
{
 "v1": {
  "datasource": "DataSourceEc2Local",
  "errors": []
 }
}
Startup finished in 4.038s (kernel) + 17.427s (userspace) = 21.466s
graphical.target reached after 15.022s in userspace
          8.154s snapd.seeded.service
          2.656s cloud-init-local.service
          2.316s apparmor.service
          2.098s dev-xvda1.device
          1.731s cloud-config.service
          1.269s systemd-networkd-wait-online.service
          1.215s cloud-init.service
          1.145s pollinate.service
           669ms cloud-final.service
           657ms networkd-dispatcher.service
           588ms lxd-containers.service
           550ms accounts-daemon.service
           465ms grub-common.service
           460ms keyboard-setup.service
           358ms apport.service
           318ms systemd-udev-trigger.service
           300ms lvm2-monitor.service
           261ms rsyslog.service
           260ms systemd-logind.service
           246ms systemd-journal-flush.service
           230ms ebtables.service
           230ms systemd-remount-fs.service
           204ms dev-hugepages.mount
           202ms dev-mqueue.mount
           201ms sys-kernel-debug.mount
           195ms polkit.service
           160ms systemd-udevd.service
           151ms ufw.service
           150ms kmod-static-nodes.service
           145ms snapd.socket
           139ms systemd-modules-load.service
           133ms lxd.socket
           132ms systemd-timesyncd.service
           119ms systemd-journald.service
           110ms systemd-sysctl.service
            88ms plymouth-read-write.service
            81ms systemd-user-sessions.service
            69ms systemd-tmpfiles-setup-dev.service
            68ms sys-kernel-config.mount
            68ms sys-fs-fuse-connections.mount
            68ms snapd.service
            59ms console-setup.service
            57ms systemd-machine-id-commit.service
            56ms systemd-tmpfiles-setup.service
            55ms systemd-random-seed.service
            54ms systemd-resolved.service
            41ms plymouth-quit.service
            40ms setvtrgb.service
            38ms plymouth-quit-wait.service
            38ms blk-availability.service
            36ms systemd-update-utmp-runlevel.service
            31ms snap-core-6350.mount
            31ms systemd-networkd.service
            30ms ssh.service
            29ms systemd-update-utmp.service
            28ms user@1000.service
            24ms snap-amazon\x2dssm\x2dagent-930.mount
            13ms dev-loop0.device
            13ms dev-loop1.device
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.02000s +00.00000s
|`->found local data from DataSourceEc2Local @00.03400s +00.45500s
Finished stage: (init-local) 00.83500 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceEc2Local @02.66100s +00.00400s
|`->setting up datasource @02.73400s +00.00000s
|`->reading and applying user-data @02.74100s +00.00700s
|`->reading and applying vendor-data @02.74900s +00.00000s
|`->activating datasource @02.78200s +00.00100s
|`->config-migrator ran successfully @02.83200s +00.00100s
|`->config-seed_random ran successfully @02.83300s +00.00100s
|`->config-bootcmd ran successfully @02.83400s +00.00000s
|`->config-write-files ran successfully @02.83500s +00.00000s
|`->config-growpart ran successfully @02.83600s +00.10900s
|`->config-resizefs ran successfully @02.94500s +00.05500s
|`->config-disk_setup ran successfully @03.00000s +00.00100s
|`->config-mounts ran successfully @03.00400s +00.00600s
|`->config-set_hostname ran successfully @03.01100s +00.00500s
|`->config-update_hostname ran successfully @03.01800s +00.00100s
|`->config-update_etc_hosts ran successfully @03.01900s +00.00000s
|`->config-ca-certs ran successfully @03.02000s +00.00000s
|`->config-rsyslog ran successfully @03.02000s +00.00500s
|`->config-users-groups ran successfully @03.02500s +00.20300s
|`->config-ssh ran successfully @03.22800s +00.10900s
Finished stage: (init-network) 00.69000 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @13.25100s +00.00000s
|`->config-snap ran successfully @13.25200s +00.00000s
|`->config-snap_config ran successfully @13.25300s +00.00000s
|`->config-ssh-import-id ran successfully @13.25300s +00.69400s
|`->config-locale ran successfully @13.94800s +00.00100s
|`->config-set-passwords ran successfully @13.95000s +00.00000s
|`->config-grub-dpkg ran successfully @13.95000s +00.19400s
|`->config-apt-pipelining ran successfully @14.14500s +00.00100s
|`->config-apt-configure ran successfully @14.14600s +00.14100s
|`->config-ubuntu-advantage ran successfully @14.28700s +00.00100s
|`->config-ntp ran successfully @14.28800s +00.00100s
|`->config-timezone ran successfully @14.28900s +00.00100s
|`->config-disable-ec2-metadata ran successfully @14.29000s +00.00000s
|`->config-runcmd ran successfully @14.29000s +00.00100s
|`->config-byobu ran successfully @14.29100s +00.00100s
Finished stage: (modules-config) 01.05900 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @14.83200s +00.00200s
|`->config-package-update-upgrade-install ran successfully @14.83400s +00.00100s
|`->config-fan ran successfully @14.83500s +00.00000s
|`->config-landscape ran successfully @14.83600s +00.00000s
|`->config-lxd ran successfully @14.83600s +00.00100s
|`->config-puppet ran successfully @14.83700s +00.00100s
|`->config-chef ran successfully @14.83800s +00.00100s
|`->config-mcollective ran successfully @14.83900s +00.00100s
|`->config-salt-minion ran successfully @14.84000s +00.00100s
|`->config-rightscale_userdata ran successfully @14.84100s +00.00000s
|`->config-scripts-vendor ran successfully @14.84200s +00.00000s
|`->config-scripts-per-once ran successfully @14.84200s +00.00100s
|`->config-scripts-per-boot ran successfully @14.84300s +00.00000s
|`->config-scripts-per-instance ran successfully @14.84400s +00.00000s
|`->config-scripts-user ran successfully @14.84500s +00.00000s
|`->config-ssh-authkey-fingerprints ran successfully @14.84500s +00.03400s
|`->config-keys-to-console ran successfully @14.87900s +00.07500s
|`->config-phone-home ran successfully @14.95400s +00.00100s
|`->config-final-message ran successfully @14.95500s +00.00500s
|`->config-power-state-change ran successfully @14.96100s +00.00000s
Finished stage: (modules-final) 00.14900 seconds 

Total Time: 2.73300 seconds

1 boot records analyzed
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 18.5-21-g8ee294d5-0ubuntu1~18.04.1 [386 kB]
Preparing to unpack .../cloud-init_18.5-21-g8ee294d5-0ubuntu1~18.04.1_all.deb ...
Unpacking cloud-init (18.5-21-g8ee294d5-0ubuntu1~18.04.1) over (18.4-0ubuntu1~18.04.1) ...
Setting up cloud-init (18.5-21-g8ee294d5-0ubuntu1~18.04.1) ...
Installing new version of config file /etc/bash_completion.d/cloud-init ...
Cloud-init v. 18.5-21-g8ee294d5-0ubuntu1~18.04.1 running 'init' at Thu, 14 Feb 2019 21:21:01 +0000. Up 98.76 seconds.
ci-info: ++++++++++++++++++++++++++++++++++++++Net device info++++++++++++++++++++++++++++++++++++++
ci-info: +--------+------+----------------------------+---------------+--------+-------------------+
ci-info: | Device |  Up  |          Address           |      Mask     | Scope  |     Hw-Address    |
ci-info: +--------+------+----------------------------+---------------+--------+-------------------+
ci-info: |  eth0  | True |        10.41.41.170        | 255.255.255.0 | global | 06:ed:0e:ed:9a:48 |
ci-info: |  eth0  | True | fe80::4ed:eff:feed:9a48/64 |       .       |  link  | 06:ed:0e:ed:9a:48 |
ci-info: |   lo   | True |         127.0.0.1          |   255.0.0.0   |  host  |         .         |
ci-info: |   lo   | True |          ::1/128           |       .       |  host  |         .         |
ci-info: +--------+------+----------------------------+---------------+--------+-------------------+
ci-info: +++++++++++++++++++++++++++++Route IPv4 info++++++++++++++++++++++++++++++
ci-info: +-------+-------------+------------+-----------------+-----------+-------+
ci-info: | Route | Destination |  Gateway   |     Genmask     | Interface | Flags |
ci-info: +-------+-------------+------------+-----------------+-----------+-------+
ci-info: |   0   |   0.0.0.0   | 10.41.41.1 |     0.0.0.0     |    eth0   |   UG  |
ci-info: |   1   |  10.41.41.0 |  0.0.0.0   |  255.255.255.0  |    eth0   |   U   |
ci-info: |   2   |  10.41.41.1 |  0.0.0.0   | 255.255.255.255 |    eth0   |   UH  |
ci-info: +-------+-------------+------------+-----------------+-----------+-------+
ci-info: +++++++++++++++++++Route IPv6 info+++++++++++++++++++
ci-info: +-------+-------------+---------+-----------+-------+
ci-info: | Route | Destination | Gateway | Interface | Flags |
ci-info: +-------+-------------+---------+-----------+-------+
ci-info: |   1   |  fe80::/64  |    ::   |    eth0   |   U   |
ci-info: |   3   |    local    |    ::   |    eth0   |   U   |
ci-info: |   4   |   ff00::/8  |    ::   |    eth0   |   U   |
ci-info: +-------+-------------+---------+-----------+-------+
1550179324.048034649

status: done
time: Thu, 14 Feb 2019 21:21:43 +0000
detail:
DataSourceEc2Local
1550179325.842179648
SRU-worked-aws
Startup finished in 4.328s (kernel) + 9.757s (userspace) = 14.085s
graphical.target reached after 7.063s in userspace
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.01100s +00.00000s
|`->found local data from DataSourceEc2Local @00.02300s +00.30400s
Finished stage: (init-local) 00.50800 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceEc2Local @02.68600s +00.00500s
|`->setting up datasource @02.76200s +00.00000s
|`->reading and applying user-data @02.76800s +00.00800s
|`->reading and applying vendor-data @02.77600s +00.00000s
|`->activating datasource @02.81200s +00.00100s
|`->config-migrator ran successfully @02.84700s +00.00100s
|`->config-seed_random ran successfully @02.84800s +00.00100s
|`->config-bootcmd ran successfully @02.84900s +00.00000s
|`->config-write-files ran successfully @02.85000s +00.00000s
|`->config-growpart ran successfully @02.85000s +00.12000s
|`->config-resizefs ran successfully @02.97000s +00.05300s
|`->config-disk_setup ran successfully @03.02300s +00.00100s
|`->config-mounts ran successfully @03.02400s +00.01000s
|`->config-set_hostname ran successfully @03.03400s +00.00900s
|`->config-update_hostname ran successfully @03.04400s +00.00100s
|`->config-update_etc_hosts ran successfully @03.04500s +00.00000s
|`->config-ca-certs ran successfully @03.04500s +00.00100s
|`->config-rsyslog ran successfully @03.04600s +00.00100s
|`->config-users-groups ran successfully @03.04700s +00.03800s
|`->config-ssh ran successfully @03.08600s +00.27200s
Finished stage: (init-network) 00.68700 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @05.63700s +00.00100s
|`->config-snap ran successfully @05.63800s +00.00100s
|`->config-snap_config ran successfully @05.63900s +00.00100s
|`->config-ssh-import-id ran successfully @05.64000s +00.72600s
|`->config-locale ran successfully @06.36600s +00.00200s
|`->config-set-passwords ran successfully @06.36800s +00.00100s
|`->config-grub-dpkg ran successfully @06.36900s +00.18500s
|`->config-apt-pipelining ran successfully @06.55500s +00.00100s
|`->config-apt-configure ran successfully @06.55600s +00.13000s
|`->config-ubuntu-advantage ran successfully @06.68600s +00.00100s
|`->config-ntp ran successfully @06.68700s +00.00100s
|`->config-timezone ran successfully @06.68800s +00.00000s
|`->config-disable-ec2-metadata ran successfully @06.68900s +00.00000s
|`->config-runcmd ran successfully @06.68900s +00.00100s
|`->config-byobu ran successfully @06.69000s +00.00100s
Finished stage: (modules-config) 01.07200 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @07.23600s +00.00200s
|`->config-package-update-upgrade-install ran successfully @07.23800s +00.00100s
|`->config-fan ran successfully @07.23900s +00.00100s
|`->config-landscape ran successfully @07.24000s +00.00100s
|`->config-lxd ran successfully @07.24100s +00.00000s
|`->config-puppet ran successfully @07.24200s +00.00000s
|`->config-chef ran successfully @07.24300s +00.00000s
|`->config-mcollective ran successfully @07.24300s +00.00100s
|`->config-salt-minion ran successfully @07.24400s +00.00100s
|`->config-rightscale_userdata ran successfully @07.24500s +00.00100s
|`->config-scripts-vendor ran successfully @07.24600s +00.00000s
|`->config-scripts-per-once ran successfully @07.24700s +00.00000s
|`->config-scripts-per-boot ran successfully @07.24800s +00.00000s
|`->config-scripts-per-instance ran successfully @07.24800s +00.00100s
|`->config-scripts-user ran successfully @07.24900s +00.00000s
|`->config-ssh-authkey-fingerprints ran successfully @07.25000s +00.04200s
|`->config-keys-to-console ran successfully @07.29200s +00.09500s
|`->config-phone-home ran successfully @07.38800s +00.00000s
|`->config-final-message ran successfully @07.38900s +00.00500s
|`->config-power-state-change ran successfully @07.39400s +00.00100s
Finished stage: (modules-final) 00.17700 seconds 

Total Time: 2.44400 seconds

1 boot records analyzed
--- Expect success on bionic for jinja because deb DOES have jinja dep.
cloud-region: aws-us-east-2
Per LP:1794399 expect we do not see a lot of killing dhclient logs
2019-02-14 21:21:36,686 - util.py[DEBUG]: Copying /sbin/dhclient to /var/tmp/cloud-init/cloud-init-dhcp-xgjyxlym/dhclient
2019-02-14 21:21:36,697 - util.py[DEBUG]: Running command ['/var/tmp/cloud-init/cloud-init-dhcp-xgjyxlym/dhclient', '-1', '-v', '-lf', '/var/tmp/cloud-init/cloud-init-dhcp-xgjyxlym/dhcp.leases', '-pf', '/var/tmp/cloud-init/cloud-init-dhcp-xgjyxlym/dhclient.pid', 'eth0', '-sf', '/bin/true'] with allowed return codes [0] (shell=False, capture=True)
2019-02-14 21:21:36,734 - util.py[DEBUG]: All files appeared after 0 seconds: ['/var/tmp/cloud-init/cloud-init-dhcp-xgjyxlym/dhclient.pid', '/var/tmp/cloud-init/cloud-init-dhcp-xgjyxlym/dhcp.leases']
2019-02-14 21:21:36,735 - util.py[DEBUG]: Reading from /var/tmp/cloud-init/cloud-init-dhcp-xgjyxlym/dhclient.pid (quiet=False)
2019-02-14 21:21:36,735 - util.py[DEBUG]: Read 4 bytes from /var/tmp/cloud-init/cloud-init-dhcp-xgjyxlym/dhclient.pid
2019-02-14 21:21:36,735 - dhcp.py[DEBUG]: killing dhclient with pid=580
Get cloud-id
aws
### END bionic
### BEGIN cosmic

status: done
time: Thu, 14 Feb 2019 21:23:52 +0000
detail:
DataSourceEc2Local
{
 "v1": {
  "datasource": "DataSourceEc2Local",
  "errors": []
 }
}
Startup finished in 4.854s (kernel) + 37.971s (userspace) = 42.825s
graphical.target reached after 35.235s in userspace
         24.120s snapd.seeded.service
          3.630s cloud-init-local.service
          2.387s cloud-init.service
          2.125s cloud-config.service
          2.123s pollinate.service
          1.788s dev-xvda1.device
          1.282s apparmor.service
          1.270s systemd-networkd-wait-online.service
           629ms cloud-final.service
           604ms systemd-resolved.service
           505ms accounts-daemon.service
           473ms systemd-logind.service
           457ms networkd-dispatcher.service
           417ms rsyslog.service
           417ms snap.lxd.activate.service
           372ms lvm2-monitor.service
           311ms systemd-networkd.service
           309ms grub-common.service
           276ms systemd-udev-trigger.service
           263ms systemd-user-sessions.service
           245ms apport.service
           233ms systemd-journal-flush.service
           191ms systemd-modules-load.service
           187ms keyboard-setup.service
           175ms polkit.service
           165ms grub-initrd-fallback.service
           161ms systemd-remount-fs.service
           158ms ufw.service
           151ms sys-kernel-debug.mount
           149ms kmod-static-nodes.service
           148ms dev-hugepages.mount
           142ms dev-mqueue.mount
           119ms ssh.service
            98ms systemd-journald.service
            93ms systemd-timesyncd.service
            90ms systemd-tmpfiles-setup.service
            77ms finalrd.service
            65ms user@1000.service
            64ms snapd.service
            62ms systemd-sysusers.service
            58ms plymouth-read-write.service
            54ms systemd-update-utmp.service
            51ms snapd.socket
            50ms systemd-machine-id-commit.service
            47ms plymouth-quit-wait.service
            44ms console-setup.service
            44ms plymouth-quit.service
            34ms systemd-random-seed.service
            30ms sys-fs-fuse-connections.mount
            30ms systemd-sysctl.service
            28ms systemd-udevd.service
            28ms systemd-update-utmp-runlevel.service
            25ms sys-kernel-config.mount
            24ms snap-lxd-10102.mount
            24ms snap-amazon\x2dssm\x2dagent-930.mount
            23ms snap-core-6350.mount
            23ms setvtrgb.service
            21ms blk-availability.service
            19ms dev-loop1.device
            19ms dev-loop2.device
            17ms dev-loop0.device
            15ms systemd-tmpfiles-setup-dev.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00000s
|`->found local data from DataSourceEc2Local @00.01200s +00.53200s
Finished stage: (init-local) 00.72100 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceEc2Local @02.81700s +00.00400s
|`->setting up datasource @02.88500s +00.00000s
|`->reading and applying user-data @02.89200s +00.00700s
|`->reading and applying vendor-data @02.89900s +00.00000s
|`->activating datasource @02.93300s +00.00100s
|`->config-migrator ran successfully @02.96300s +00.00100s
|`->config-seed_random ran successfully @02.96400s +00.00100s
|`->config-bootcmd ran successfully @02.96500s +00.00000s
|`->config-write-files ran successfully @02.96600s +00.00000s
|`->config-growpart ran successfully @02.96600s +00.61000s
|`->config-resizefs ran successfully @03.57600s +00.10000s
|`->config-disk_setup ran successfully @03.67600s +00.00100s
|`->config-mounts ran successfully @03.67700s +00.00200s
|`->config-set_hostname ran successfully @03.67900s +00.00400s
|`->config-update_hostname ran successfully @03.68400s +00.00100s
|`->config-update_etc_hosts ran successfully @03.68500s +00.00000s
|`->config-ca-certs ran successfully @03.68600s +00.00000s
|`->config-rsyslog ran successfully @03.68600s +00.00100s
|`->config-users-groups ran successfully @03.68700s +00.46800s
|`->config-ssh ran successfully @04.15500s +00.53900s
Finished stage: (init-network) 01.89000 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @32.19800s +00.00000s
|`->config-snap ran successfully @32.19900s +00.00000s
|`->config-snap_config ran successfully @32.20000s +00.00000s
|`->config-ssh-import-id ran successfully @32.20000s +00.82100s
|`->config-locale ran successfully @33.02100s +00.00100s
|`->config-set-passwords ran successfully @33.02300s +00.00000s
|`->config-grub-dpkg ran successfully @33.02400s +00.17600s
|`->config-apt-pipelining ran successfully @33.20100s +00.00100s
|`->config-apt-configure ran successfully @33.20200s +00.20900s
|`->config-ubuntu-advantage ran successfully @33.41100s +00.00100s
|`->config-ntp ran successfully @33.41200s +00.00100s
|`->config-timezone ran successfully @33.41300s +00.00100s
|`->config-disable-ec2-metadata ran successfully @33.41400s +00.00000s
|`->config-runcmd ran successfully @33.41400s +00.00100s
|`->config-byobu ran successfully @33.41500s +00.00100s
Finished stage: (modules-config) 01.23400 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @33.93000s +00.00200s
|`->config-package-update-upgrade-install ran successfully @33.93200s +00.00100s
|`->config-fan ran successfully @33.93300s +00.00000s
|`->config-landscape ran successfully @33.93400s +00.00000s
|`->config-lxd ran successfully @33.93400s +00.00100s
|`->config-puppet ran successfully @33.93500s +00.00100s
|`->config-chef ran successfully @33.93600s +00.00100s
|`->config-mcollective ran successfully @33.93700s +00.00100s
|`->config-salt-minion ran successfully @33.93800s +00.00100s
|`->config-rightscale_userdata ran successfully @33.93900s +00.00000s
|`->config-scripts-vendor ran successfully @33.94000s +00.00000s
|`->config-scripts-per-once ran successfully @33.94000s +00.00100s
|`->config-scripts-per-boot ran successfully @33.94100s +00.00000s
|`->config-scripts-per-instance ran successfully @33.94200s +00.00000s
|`->config-scripts-user ran successfully @33.94300s +00.00000s
|`->config-ssh-authkey-fingerprints ran successfully @33.94300s +00.02900s
|`->config-keys-to-console ran successfully @33.97200s +00.06600s
|`->config-phone-home ran successfully @34.03800s +00.00100s
|`->config-final-message ran successfully @34.03900s +00.00500s
|`->config-power-state-change ran successfully @34.04400s +00.00100s
Finished stage: (modules-final) 00.13300 seconds 

Total Time: 3.97800 seconds

1 boot records analyzed
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu cosmic-proposed/main amd64 cloud-init all 18.5-21-g8ee294d5-0ubuntu1~18.10.1 [383 kB]
Preparing to unpack .../cloud-init_18.5-21-g8ee294d5-0ubuntu1~18.10.1_all.deb ...
Unpacking cloud-init (18.5-21-g8ee294d5-0ubuntu1~18.10.1) over (18.4-7-g4652b196-0ubuntu1) ...
Setting up cloud-init (18.5-21-g8ee294d5-0ubuntu1~18.10.1) ...
Installing new version of config file /etc/bash_completion.d/cloud-init ...
Cloud-init v. 18.5-21-g8ee294d5-0ubuntu1~18.10.1 running 'init' at Thu, 14 Feb 2019 21:24:34 +0000. Up 84.82 seconds.
ci-info: ++++++++++++++++++++++++++++++++++++++Net device info+++++++++++++++++++++++++++++++++++++++
ci-info: +--------+------+-----------------------------+---------------+--------+-------------------+
ci-info: | Device |  Up  |           Address           |      Mask     | Scope  |     Hw-Address    |
ci-info: +--------+------+-----------------------------+---------------+--------+-------------------+
ci-info: |  eth0  | True |         10.41.41.228        | 255.255.255.0 | global | 06:9c:49:68:a0:94 |
ci-info: |  eth0  | True | fe80::49c:49ff:fe68:a094/64 |       .       |  link  | 06:9c:49:68:a0:94 |
ci-info: |   lo   | True |          127.0.0.1          |   255.0.0.0   |  host  |         .         |
ci-info: |   lo   | True |           ::1/128           |       .       |  host  |         .         |
ci-info: +--------+------+-----------------------------+---------------+--------+-------------------+
ci-info: +++++++++++++++++++++++++++++Route IPv4 info++++++++++++++++++++++++++++++
ci-info: +-------+-------------+------------+-----------------+-----------+-------+
ci-info: | Route | Destination |  Gateway   |     Genmask     | Interface | Flags |
ci-info: +-------+-------------+------------+-----------------+-----------+-------+
ci-info: |   0   |   0.0.0.0   | 10.41.41.1 |     0.0.0.0     |    eth0   |   UG  |
ci-info: |   1   |  10.41.41.0 |  0.0.0.0   |  255.255.255.0  |    eth0   |   U   |
ci-info: |   2   |  10.41.41.1 |  0.0.0.0   | 255.255.255.255 |    eth0   |   UH  |
ci-info: +-------+-------------+------------+-----------------+-----------+-------+
ci-info: +++++++++++++++++++Route IPv6 info+++++++++++++++++++
ci-info: +-------+-------------+---------+-----------+-------+
ci-info: | Route | Destination | Gateway | Interface | Flags |
ci-info: +-------+-------------+---------+-----------+-------+
ci-info: |   1   |  fe80::/64  |    ::   |    eth0   |   U   |
ci-info: |   3   |    local    |    ::   |    eth0   |   U   |
ci-info: |   4   |   ff00::/8  |    ::   |    eth0   |   U   |
ci-info: +-------+-------------+---------+-----------+-------+
1550179537.631508922

status: done
time: Thu, 14 Feb 2019 21:25:09 +0000
detail:
DataSourceEc2Local
1550179539.459692150
SRU-worked-aws
Startup finished in 4.207s (kernel) + 9.773s (userspace) = 13.981s
graphical.target reached after 7.304s in userspace
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00800s +00.00000s
|`->found local data from DataSourceEc2Local @00.02300s +00.54400s
Finished stage: (init-local) 00.75500 seconds 

Starting stage: init-network
|`->restored from cache with run check: DataSourceEc2Local @02.68200s +00.00400s
|`->setting up datasource @02.75400s +00.00000s
|`->reading and applying user-data @02.76000s +00.00800s
|`->reading and applying vendor-data @02.76800s +00.00000s
|`->activating datasource @02.80100s +00.00200s
|`->config-migrator ran successfully @02.83300s +00.00000s
|`->config-seed_random ran successfully @02.83300s +00.00100s
|`->config-bootcmd ran successfully @02.83400s +00.00800s
|`->config-write-files ran successfully @02.84200s +00.00100s
|`->config-growpart ran successfully @02.84300s +00.11300s
|`->config-resizefs ran successfully @02.95600s +00.05700s
|`->config-disk_setup ran successfully @03.01300s +00.00100s
|`->config-mounts ran successfully @03.01400s +00.00200s
|`->config-set_hostname ran successfully @03.01600s +00.00400s
|`->config-update_hostname ran successfully @03.02100s +00.00100s
|`->config-update_etc_hosts ran successfully @03.02200s +00.00000s
|`->config-ca-certs ran successfully @03.02300s +00.00000s
|`->config-rsyslog ran successfully @03.02400s +00.00000s
|`->config-users-groups ran successfully @03.02500s +00.01500s
|`->config-ssh ran successfully @03.04000s +00.25600s
Finished stage: (init-network) 00.62700 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @05.80900s +00.00000s
|`->config-snap ran successfully @05.80900s +00.00100s
|`->config-snap_config ran successfully @05.81000s +00.00100s
|`->config-ssh-import-id ran successfully @05.81100s +00.87600s
|`->config-locale ran successfully @06.68700s +00.00200s
|`->config-set-passwords ran successfully @06.68900s +00.00100s
|`->config-grub-dpkg ran successfully @06.69000s +00.20200s
|`->config-apt-pipelining ran successfully @06.89300s +00.00100s
|`->config-apt-configure ran successfully @06.89400s +00.10200s
|`->config-ubuntu-advantage ran successfully @06.99600s +00.00100s
|`->config-ntp ran successfully @06.99700s +00.00100s
|`->config-timezone ran successfully @06.99800s +00.00100s
|`->config-disable-ec2-metadata ran successfully @06.99900s +00.00000s
|`->config-runcmd ran successfully @06.99900s +00.00100s
|`->config-byobu ran successfully @07.00000s +00.00100s
Finished stage: (modules-config) 01.20900 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @07.52300s +00.00200s
|`->config-package-update-upgrade-install ran successfully @07.52500s +00.00100s
|`->config-fan ran successfully @07.52600s +00.00100s
|`->config-landscape ran successfully @07.52700s +00.00000s
|`->config-lxd ran successfully @07.52800s +00.00000s
|`->config-puppet ran successfully @07.52800s +00.00100s
|`->config-chef ran successfully @07.52900s +00.00100s
|`->config-mcollective ran successfully @07.53000s +00.00100s
|`->config-salt-minion ran successfully @07.53100s +00.00100s
|`->config-rightscale_userdata ran successfully @07.53200s +00.00100s
|`->config-scripts-vendor ran successfully @07.53300s +00.00000s
|`->config-scripts-per-once ran successfully @07.53400s +00.00000s
|`->config-scripts-per-boot ran successfully @07.53500s +00.00000s
|`->config-scripts-per-instance ran successfully @07.53500s +00.00100s
|`->config-scripts-user ran successfully @07.53600s +00.00000s
|`->config-ssh-authkey-fingerprints ran successfully @07.53700s +00.02800s
|`->config-keys-to-console ran successfully @07.56600s +00.06200s
|`->config-phone-home ran successfully @07.62900s +00.00100s
|`->config-final-message ran successfully @07.63000s +00.00500s
|`->config-power-state-change ran successfully @07.63500s +00.00100s
Finished stage: (modules-final) 00.13100 seconds 

Total Time: 2.72200 seconds

1 boot records analyzed
--- Expect success on bionic for jinja because deb DOES have jinja dep.
cloud-region: aws-us-east-2
Per LP:1794399 expect we do not see a lot of killing dhclient logs
2019-02-14 21:25:02,618 - util.py[DEBUG]: Copying /sbin/dhclient to /var/tmp/cloud-init/cloud-init-dhcp-9bzyvj4a/dhclient
2019-02-14 21:25:02,630 - util.py[DEBUG]: Running command ['/var/tmp/cloud-init/cloud-init-dhcp-9bzyvj4a/dhclient', '-1', '-v', '-lf', '/var/tmp/cloud-init/cloud-init-dhcp-9bzyvj4a/dhcp.leases', '-pf', '/var/tmp/cloud-init/cloud-init-dhcp-9bzyvj4a/dhclient.pid', 'eth0', '-sf', '/bin/true'] with allowed return codes [0] (shell=False, capture=True)
2019-02-14 21:25:02,652 - util.py[DEBUG]: All files appeared after 0 seconds: ['/var/tmp/cloud-init/cloud-init-dhcp-9bzyvj4a/dhclient.pid', '/var/tmp/cloud-init/cloud-init-dhcp-9bzyvj4a/dhcp.leases']
2019-02-14 21:25:02,653 - util.py[DEBUG]: Reading from /var/tmp/cloud-init/cloud-init-dhcp-9bzyvj4a/dhclient.pid (quiet=False)
2019-02-14 21:25:02,653 - util.py[DEBUG]: Read 4 bytes from /var/tmp/cloud-init/cloud-init-dhcp-9bzyvj4a/dhclient.pid
2019-02-14 21:25:02,653 - dhcp.py[DEBUG]: killing dhclient with pid=599
Get cloud-id
aws
### END cosmic
