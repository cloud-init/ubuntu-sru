# Manual GCE upgrade and clean install validation Xenial, Bionic, Cosmic
 
# To be adapted to the SRU to test
SRU_SERIES="xenial bionic disco"
ZONE="us-central1-b"

cat > sethostname.yaml << EOF
## template: jinja
#cloud-config
ssh_import_id : [daniel-thewatkins]
hostname: SRU-worked-{{v1.cloud_name}}
EOF

cat > setup_proposed.sh <<EOF
#/bin/bash
mirror=http://archive.ubuntu.com/ubuntu
echo deb \$mirror \$(lsb_release -sc)-proposed main | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init
EOF

sshopts=( -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o LogLevel=ERROR )


for release in $SRU_SERIES; do
  echo "### BEGIN $release"

  netcfg=/etc/netplan/50-cloud-init.yaml
  case $release in
      xenial) family=ubuntu-1604-lts
              netcfg=/etc/network/interfaces.d/50-cloud-init.cfg;;
      bionic) family=ubuntu-1804-lts;;
      cosmic) family=ubuntu-1810;;
      disco) family=ubuntu-1904;;
      *) echo "!! UPDATE FAMILY CASE STATEMENT !!"; exit 1;;
  esac

  gcloud compute instances create $release-sru-test --image-family $family --image-project ubuntu-os-cloud-devel --metadata-from-file user-data=sethostname.yaml --zone=$ZONE;
  VM_IP=$(gcloud compute instances list | grep $release-sru | awk '{printf "%s", $5}')

  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 5
  done

  # Capture current state
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- dpkg-query --show cloud-init
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo cat /run/cloud-init/result.json
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- grep Trace /var/log/cloud-init.log
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze blame
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze show
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze blame
  echo 'Networking config'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cat $netcfg

  # Upgrade to -proposed cloud-init and reboot
  scp "${sshopts[@]}" setup_proposed.sh ubuntu@$VM_IP:.
  ssh "${sshopts[@]}" ubuntu@$VM_IP sudo bash ./setup_proposed.sh 2>&1 | egrep 'cloud-init'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- dpkg-query --show cloud-init
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo hostname SRU-didnt-work
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo rm -f $netcfg
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo cloud-init clean --logs --reboot
  ssh-keygen -f "/home/ubuntu/.ssh/known_hosts" -R $VM_IP

  sleep 10  # Wait for the instance to actually go down
  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 5
  done

  ssh "${sshopts[@]}" ubuntu@$VM_IP -- hostname
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- "grep Trace /var/log/cloud-init*"
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- systemd-analyze blame
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze show
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init analyze blame
  echo 'After upgrade Networking config'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cat $netcfg
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init query --format "'cloud-region: {{cloud_name}}-{{region}}'"
  echo "Get cloud-id"
  ssh "${sshopts[@]}" ubuntu@$VM_IP cloud-id

  echo 'Validating whether metadata is being updated per boot LP:1819913'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- grep "Update\ datasource" /var/log/cloud-init.log
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- sudo reboot || true

  sleep 10  # Wait for the instance to actually go down
  while ! ssh "${sshopts[@]}" ubuntu@$VM_IP -- cloud-init status --wait --long; do
      sleep 5
  done
  echo 'After reboot'
  ssh "${sshopts[@]}" ubuntu@$VM_IP -- grep "Update\ datasource" /var/log/cloud-init.log
done

for release in $SRU_SERIES; do
  gcloud compute instances delete --zone=$ZONE --quiet $release-sru-test
done
### BEGIN xenial
NAME             ZONE           MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP  STATUS
xenial-sru-test  us-central1-b  n1-standard-1               10.240.0.63  34.66.96.17  RUNNING

status: done
time: Fri, 04 Oct 2019 20:05:17 +0000
detail:
DataSourceGCE
cloud-init	19.2-36-g059d049c-0ubuntu1~16.04.1
{
 "v1": {
  "datasource": "DataSourceGCE",
  "errors": []
 }
}
Startup finished in 2.338s (kernel) + 34.623s (userspace) = 36.961s
         24.573s snapd.seeded.service
         10.456s pollinate.service
          2.421s cloud-config.service
          2.369s apparmor.service
          2.158s accounts-daemon.service
          2.145s cloud-init-local.service
          1.894s open-iscsi.service
          1.829s console-setup.service
          1.707s apport.service
          1.702s ondemand.service
          1.362s ntp.service
          1.229s dev-sda1.device
          1.092s cloud-init.service
          1.083s mdadm.service
          1.035s google-instance-setup.service
          1.029s snapd.service
           979ms lxd-containers.service
           948ms grub-common.service
           681ms systemd-user-sessions.service
           668ms plymouth-quit-wait.service
           656ms lvm2-monitor.service
           547ms iscsid.service
           479ms cloud-final.service
           437ms sshguard.service
           416ms lxd.socket
           358ms polkitd.service
           349ms networking.service
           345ms plymouth-quit.service
           344ms google-shutdown-scripts.service
           307ms snapd.socket
           305ms systemd-logind.service
           268ms rc-local.service
           232ms google-startup-scripts.service
           196ms rsyslog.service
           137ms systemd-remount-fs.service
           122ms resolvconf.service
           100ms kmod-static-nodes.service
            93ms systemd-update-utmp.service
            87ms systemd-journald.service
            87ms dev-hugepages.mount
            83ms systemd-machine-id-commit.service
            81ms systemd-tmpfiles-setup.service
            78ms keyboard-setup.service
            78ms systemd-udev-trigger.service
            77ms ufw.service
            77ms systemd-modules-load.service
            67ms systemd-udevd.service
            61ms systemd-journal-flush.service
            59ms sys-kernel-debug.mount
            50ms sys-kernel-config.mount
            47ms dev-mqueue.mount
            38ms systemd-sysctl.service
            37ms sys-fs-fuse-connections.mount
            36ms systemd-tmpfiles-setup-dev.service
            33ms ssh.service
            30ms plymouth-read-write.service
            21ms user@1000.service
            20ms systemd-random-seed.service
            15ms systemd-update-utmp-runlevel.service
             6ms setvtrgb.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.01400s +00.00000s
Finished stage: (init-local) 00.06400 seconds 

Starting stage: init-network
|`->no cache found @01.05600s +00.00000s
|`->found network data from DataSourceGCE @01.06000s +00.06900s
|`->setting up datasource @01.19600s +00.00000s
|`->reading and applying user-data @01.20700s +00.00800s
|`->reading and applying vendor-data @01.21500s +00.00000s
|`->activating datasource @01.24200s +00.00100s
|`->config-migrator ran successfully @01.26600s +00.00100s
|`->config-seed_random ran successfully @01.26700s +00.00100s
|`->config-bootcmd ran successfully @01.26800s +00.00000s
|`->config-write-files ran successfully @01.26800s +00.00100s
|`->config-growpart ran successfully @01.26900s +00.10700s
|`->config-resizefs ran successfully @01.37600s +00.05300s
|`->config-disk_setup ran successfully @01.42900s +00.00100s
|`->config-mounts ran successfully @01.43100s +00.00100s
|`->config-set_hostname ran successfully @01.43200s +00.00500s
|`->config-update_hostname ran successfully @01.43700s +00.00100s
|`->config-update_etc_hosts ran successfully @01.43900s +00.00000s
|`->config-ca-certs ran successfully @01.43900s +00.00100s
|`->config-rsyslog ran successfully @01.44000s +00.00100s
|`->config-users-groups ran successfully @01.44100s +00.08600s
|`->config-ssh ran successfully @01.52700s +00.24900s
Finished stage: (init-network) 00.73500 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @28.27600s +00.00100s
|`->config-snap ran successfully @28.27700s +00.00100s
|`->config-snap_config ran successfully @28.27800s +00.00100s
|`->config-ssh-import-id ran successfully @28.27900s +00.77500s
|`->config-locale ran successfully @29.05500s +00.88400s
|`->config-set-passwords ran successfully @29.93900s +00.00100s
|`->config-grub-dpkg ran successfully @29.94100s +00.19900s
|`->config-apt-pipelining ran successfully @30.14100s +00.00100s
|`->config-apt-configure ran successfully @30.14200s +00.10800s
|`->config-ubuntu-advantage ran successfully @30.25000s +00.00100s
|`->config-ntp ran successfully @30.25200s +00.00000s
|`->config-timezone ran successfully @30.25300s +00.00000s
|`->config-disable-ec2-metadata ran successfully @30.25300s +00.00100s
|`->config-runcmd ran successfully @30.25400s +00.00100s
|`->config-byobu ran successfully @30.25500s +00.00100s
Finished stage: (modules-config) 02.00500 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @30.68700s +00.00200s
|`->config-package-update-upgrade-install ran successfully @30.68900s +00.00100s
|`->config-fan ran successfully @30.69000s +00.00000s
|`->config-landscape ran successfully @30.69100s +00.00000s
|`->config-lxd ran successfully @30.69200s +00.00000s
|`->config-ubuntu-drivers ran successfully @30.69200s +00.00100s
|`->config-puppet ran successfully @30.69300s +00.00100s
|`->config-chef ran successfully @30.69400s +00.00100s
|`->config-mcollective ran successfully @30.69500s +00.00000s
|`->config-salt-minion ran successfully @30.69600s +00.00000s
|`->config-rightscale_userdata ran successfully @30.69600s +00.00100s
|`->config-scripts-vendor ran successfully @30.69700s +00.00100s
|`->config-scripts-per-once ran successfully @30.69800s +00.00100s
|`->config-scripts-per-boot ran successfully @30.69900s +00.00000s
|`->config-scripts-per-instance ran successfully @30.69900s +00.00100s
|`->config-scripts-user ran successfully @30.70000s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @30.70100s +00.00200s
|`->config-keys-to-console ran successfully @30.70400s +00.02100s
|`->config-phone-home ran successfully @30.72600s +00.00100s
|`->config-final-message ran successfully @30.72700s +00.00600s
|`->config-power-state-change ran successfully @30.73400s +00.00000s
Finished stage: (modules-final) 00.07900 seconds 

Total Time: 2.88300 seconds

1 boot records analyzed
-- Boot Record 01 --
     00.88400s (modules-config/config-locale)
     00.77500s (modules-config/config-ssh-import-id)
     00.24900s (init-network/config-ssh)
     00.19900s (modules-config/config-grub-dpkg)
     00.10800s (modules-config/config-apt-configure)
     00.10700s (init-network/config-growpart)
     00.08600s (init-network/config-users-groups)
     00.06900s (init-network/search-GCE)
     00.05300s (init-network/config-resizefs)
     00.02100s (modules-final/config-keys-to-console)
     00.00800s (init-network/consume-user-data)
     00.00600s (modules-final/config-final-message)
     00.00500s (init-network/config-set_hostname)
     00.00200s (modules-final/config-ssh-authkey-fingerprints)
     00.00200s (modules-final/config-snappy)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-emit_upstart)
     00.00100s (modules-config/config-disable-ec2-metadata)
     00.00100s (modules-config/config-byobu)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-mounts)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-disk_setup)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/activate-datasource)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-salt-minion)
     00.00000s (modules-final/config-power-state-change)
     00.00000s (modules-final/config-mcollective)
     00.00000s (modules-final/config-lxd)
     00.00000s (modules-final/config-landscape)
     00.00000s (modules-final/config-fan)
     00.00000s (modules-config/config-timezone)
     00.00000s (modules-config/config-ntp)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-update_etc_hosts)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)
     00.00000s (init-local/check-cache)

1 boot records analyzed
Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
auto lo
iface lo inet loopback

auto ens4
iface ens4 inet dhcp
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu xenial-proposed/main amd64 cloud-init all 19.2-36-g059d049c-0ubuntu2~16.04.1 [408 kB]
Preparing to unpack .../cloud-init_19.2-36-g059d049c-0ubuntu2~16.04.1_all.deb ...
Unpacking cloud-init (19.2-36-g059d049c-0ubuntu2~16.04.1) over (19.2-36-g059d049c-0ubuntu1~16.04.1) ...
Setting up cloud-init (19.2-36-g059d049c-0ubuntu2~16.04.1) ...
Leaving 'diversion of /etc/init/ureadahead.conf to /etc/init/ureadahead.conf.disabled by cloud-init'
cloud-init	19.2-36-g059d049c-0ubuntu2~16.04.1

status: done
time: Fri, 04 Oct 2019 20:06:37 +0000
detail:
DataSourceGCE
SRU-worked-gce
Startup finished in 2.521s (kernel) + 13.445s (userspace) = 15.967s
          2.252s cloud-final.service
          1.834s cloud-config.service
          1.792s dev-sda1.device
          1.774s cloud-init-local.service
          1.353s ssh.service
          1.052s snapd.service
          1.039s pollinate.service
          1.000s google-instance-setup.service
           918ms lxd-containers.service
           893ms cloud-init.service
           862ms accounts-daemon.service
           783ms lvm2-monitor.service
           770ms open-iscsi.service
           740ms apparmor.service
           681ms google-shutdown-scripts.service
           560ms grub-common.service
           476ms rsyslog.service
           475ms mdadm.service
           467ms iscsid.service
           405ms polkitd.service
           368ms lxd.socket
           346ms networking.service
           343ms snapd.seeded.service
           327ms ntp.service
           267ms systemd-logind.service
           251ms sshguard.service
           229ms console-setup.service
           223ms resolvconf.service
           221ms google-startup-scripts.service
           216ms apport.service
           205ms keyboard-setup.service
           202ms kmod-static-nodes.service
           192ms systemd-remount-fs.service
           180ms ondemand.service
           178ms ufw.service
           175ms snapd.socket
           175ms systemd-udev-trigger.service
           167ms systemd-journald.service
           166ms systemd-modules-load.service
           159ms rc-local.service
           151ms dev-hugepages.mount
           144ms systemd-tmpfiles-setup-dev.service
           136ms systemd-journal-flush.service
           133ms setvtrgb.service
           128ms systemd-random-seed.service
            87ms systemd-sysctl.service
            87ms sys-kernel-debug.mount
            84ms systemd-user-sessions.service
            79ms sys-kernel-config.mount
            68ms dev-mqueue.mount
            67ms plymouth-quit.service
            65ms plymouth-quit-wait.service
            51ms systemd-udevd.service
            47ms systemd-tmpfiles-setup.service
            47ms sys-fs-fuse-connections.mount
            21ms user@1000.service
            18ms systemd-update-utmp.service
            15ms plymouth-read-write.service
             8ms systemd-update-utmp-runlevel.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00000s
Finished stage: (init-local) 00.03900 seconds 

Starting stage: init-network
|`->no cache found @00.83500s +00.00100s
|`->found network data from DataSourceGCE @00.84000s +00.04900s
|`->setting up datasource @00.95700s +00.00000s
|`->reading and applying user-data @00.96900s +00.00700s
|`->reading and applying vendor-data @00.97600s +00.00000s
|`->activating datasource @01.00300s +00.00100s
|`->config-migrator ran successfully @01.02600s +00.00100s
|`->config-seed_random ran successfully @01.02700s +00.00100s
|`->config-bootcmd ran successfully @01.02800s +00.00000s
|`->config-write-files ran successfully @01.02800s +00.00100s
|`->config-growpart ran successfully @01.02900s +00.06700s
|`->config-resizefs ran successfully @01.09700s +00.02600s
|`->config-disk_setup ran successfully @01.12400s +00.00100s
|`->config-mounts ran successfully @01.12500s +00.00300s
|`->config-set_hostname ran successfully @01.12900s +00.00400s
|`->config-update_hostname ran successfully @01.13400s +00.00100s
|`->config-update_etc_hosts ran successfully @01.13500s +00.00100s
|`->config-ca-certs ran successfully @01.13600s +00.00000s
|`->config-rsyslog ran successfully @01.13700s +00.00000s
|`->config-users-groups ran successfully @01.13800s +00.05500s
|`->config-ssh ran successfully @01.19300s +00.14500s
Finished stage: (init-network) 00.51700 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @06.94400s +00.00000s
|`->config-snap ran successfully @06.94400s +00.00100s
|`->config-snap_config ran successfully @06.94500s +00.00100s
|`->config-ssh-import-id ran successfully @06.94600s +00.66700s
|`->config-locale ran successfully @07.61300s +00.00200s
|`->config-set-passwords ran successfully @07.61500s +00.00100s
|`->config-grub-dpkg ran successfully @07.61600s +00.43000s
|`->config-apt-pipelining ran successfully @08.04700s +00.00100s
|`->config-apt-configure ran successfully @08.04800s +00.23600s
|`->config-ubuntu-advantage ran successfully @08.28500s +00.00100s
|`->config-ntp ran successfully @08.28600s +00.00100s
|`->config-timezone ran successfully @08.28700s +00.00100s
|`->config-disable-ec2-metadata ran successfully @08.28800s +00.00000s
|`->config-runcmd ran successfully @08.28900s +00.00000s
|`->config-byobu ran successfully @08.29000s +00.00000s
Finished stage: (modules-config) 01.37500 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @09.25400s +00.00200s
|`->config-package-update-upgrade-install ran successfully @09.25600s +00.00100s
|`->config-fan ran successfully @09.25700s +00.00100s
|`->config-landscape ran successfully @09.25800s +00.00100s
|`->config-lxd ran successfully @09.25900s +00.00100s
|`->config-ubuntu-drivers ran successfully @09.26000s +00.00100s
|`->config-puppet ran successfully @09.26100s +00.00000s
|`->config-chef ran successfully @09.26200s +00.00000s
|`->config-mcollective ran successfully @09.26200s +00.00100s
|`->config-salt-minion ran successfully @09.26300s +00.00100s
|`->config-rightscale_userdata ran successfully @09.26400s +00.00100s
|`->config-scripts-vendor ran successfully @09.26500s +00.00100s
|`->config-scripts-per-once ran successfully @09.26600s +00.00100s
|`->config-scripts-per-boot ran successfully @09.26700s +00.00000s
|`->config-scripts-per-instance ran successfully @09.26700s +00.00100s
|`->config-scripts-user ran successfully @09.26800s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @09.26900s +01.44000s
|`->config-keys-to-console ran successfully @10.70900s +00.33900s
|`->config-phone-home ran successfully @11.04900s +00.00100s
|`->config-final-message ran successfully @11.05000s +00.00600s
|`->config-power-state-change ran successfully @11.05600s +00.00100s
Finished stage: (modules-final) 01.83300 seconds 

Total Time: 3.76400 seconds

1 boot records analyzed
-- Boot Record 01 --
     01.44000s (modules-final/config-ssh-authkey-fingerprints)
     00.66700s (modules-config/config-ssh-import-id)
     00.43000s (modules-config/config-grub-dpkg)
     00.33900s (modules-final/config-keys-to-console)
     00.23600s (modules-config/config-apt-configure)
     00.14500s (init-network/config-ssh)
     00.06700s (init-network/config-growpart)
     00.05500s (init-network/config-users-groups)
     00.04900s (init-network/search-GCE)
     00.02600s (init-network/config-resizefs)
     00.00700s (init-network/consume-user-data)
     00.00600s (modules-final/config-final-message)
     00.00400s (init-network/config-set_hostname)
     00.00300s (init-network/config-mounts)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-config/config-locale)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-ntp)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-disk_setup)
     00.00100s (init-network/check-cache)
     00.00100s (init-network/activate-datasource)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-puppet)
     00.00000s (modules-final/config-chef)
     00.00000s (modules-config/config-runcmd)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (modules-config/config-byobu)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-rsyslog)
     00.00000s (init-network/config-ca-certs)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-local/check-cache)

1 boot records analyzed
After upgrade Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
auto lo
iface lo inet loopback

auto ens4
iface ens4 inet dhcp
cloud-region: gce-us-central1
Get cloud-id
gce
Validating whether metadata is being updated per boot LP:1819913
2019-10-04 20:06:27,382 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot

status: done
time: Fri, 04 Oct 2019 20:07:19 +0000
detail:
DataSourceGCE
After reboot
2019-10-04 20:06:27,382 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-10-04 20:07:11,357 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
### BEGIN bionic
NAME             ZONE           MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP     STATUS
bionic-sru-test  us-central1-b  n1-standard-1               10.240.0.64  35.226.101.247  RUNNING

status: done
time: Fri, 04 Oct 2019 20:05:25 +0000
detail:
DataSourceGCE
cloud-init	19.2-36-g059d049c-0ubuntu1~18.04.1
{
 "v1": {
  "datasource": "DataSourceGCE",
  "errors": []
 }
}
Startup finished in 2.628s (kernel) + 35.415s (userspace) = 38.044s
graphical.target reached after 32.410s in userspace
         19.904s snapd.seeded.service
         10.361s pollinate.service
          3.992s accounts-daemon.service
          2.205s apport.service
          2.190s grub-common.service
          2.013s cloud-config.service
          1.979s dev-sda1.device
          1.889s keyboard-setup.service
          1.783s cloud-init.service
          1.612s systemd-logind.service
          1.575s cloud-init-local.service
          1.372s systemd-user-sessions.service
          1.368s polkit.service
          1.213s systemd-networkd-wait-online.service
          1.055s snapd.service
          1.053s apparmor.service
          1.024s plymouth-quit.service
           904ms networkd-dispatcher.service
           784ms sshguard.service
           744ms rsyslog.service
           686ms google-instance-setup.service
           678ms lxd-containers.service
           676ms cloud-final.service
           344ms plymouth-quit-wait.service
           339ms setvtrgb.service
           339ms google-shutdown-scripts.service
           306ms google-startup-scripts.service
           294ms lxd.socket
           280ms lvm2-monitor.service
           279ms systemd-udev-trigger.service
           263ms snapd.socket
           207ms ebtables.service
           201ms systemd-modules-load.service
           193ms ufw.service
           183ms kmod-static-nodes.service
           167ms systemd-remount-fs.service
           166ms dev-mqueue.mount
           166ms dev-hugepages.mount
           165ms sys-kernel-debug.mount
           164ms systemd-journal-flush.service
           121ms systemd-networkd.service
           115ms systemd-sysctl.service
           115ms systemd-random-seed.service
           115ms sys-fs-fuse-connections.mount
           115ms sys-kernel-config.mount
           113ms systemd-tmpfiles-setup-dev.service
           111ms systemd-journald.service
            80ms systemd-machine-id-commit.service
            65ms systemd-udevd.service
            63ms console-setup.service
            63ms systemd-tmpfiles-setup.service
            63ms blk-availability.service
            63ms plymouth-read-write.service
            62ms chrony.service
            53ms systemd-resolved.service
            47ms boot-efi.mount
            43ms user@1000.service
            34ms ssh.service
            31ms dev-loop0.device
            27ms dev-loop1.device
            27ms systemd-update-utmp.service
            25ms snap-google\x2dcloud\x2dsdk-101.mount
            24ms snap-core-7713.mount
            16ms systemd-update-utmp-runlevel.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00400s +00.00000s
Finished stage: (init-local) 00.22900 seconds 

Starting stage: init-network
|`->no cache found @02.16300s +00.00000s
|`->found network data from DataSourceGCE @02.18900s +00.07200s
|`->setting up datasource @02.44700s +00.00000s
|`->reading and applying user-data @02.46300s +00.00800s
|`->reading and applying vendor-data @02.47200s +00.00000s
|`->activating datasource @02.50300s +00.00300s
|`->config-migrator ran successfully @02.53400s +00.00000s
|`->config-seed_random ran successfully @02.53400s +00.00100s
|`->config-bootcmd ran successfully @02.53500s +00.00100s
|`->config-write-files ran successfully @02.53600s +00.00100s
|`->config-growpart ran successfully @02.53700s +00.19600s
|`->config-resizefs ran successfully @02.73400s +00.17900s
|`->config-disk_setup ran successfully @02.91300s +00.00100s
|`->config-mounts ran successfully @02.91500s +00.00100s
|`->config-set_hostname ran successfully @02.91600s +00.00600s
|`->config-update_hostname ran successfully @02.92200s +00.00100s
|`->config-update_etc_hosts ran successfully @02.92400s +00.00000s
|`->config-ca-certs ran successfully @02.92400s +00.00100s
|`->config-rsyslog ran successfully @02.92500s +00.00100s
|`->config-users-groups ran successfully @02.92600s +00.09800s
|`->config-ssh ran successfully @03.02400s +00.38500s
Finished stage: (init-network) 01.26400 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @27.39000s +00.00000s
|`->config-snap ran successfully @27.39000s +00.00100s
|`->config-snap_config ran successfully @27.39100s +00.00000s
|`->config-ssh-import-id ran successfully @27.39200s +00.81000s
|`->config-locale ran successfully @28.20200s +00.00200s
|`->config-set-passwords ran successfully @28.20400s +00.00100s
|`->config-grub-dpkg ran successfully @28.20500s +00.30900s
|`->config-apt-pipelining ran successfully @28.51500s +00.00100s
|`->config-apt-configure ran successfully @28.51600s +00.11300s
|`->config-ubuntu-advantage ran successfully @28.62900s +00.00100s
|`->config-ntp ran successfully @28.63100s +00.08600s
|`->config-timezone ran successfully @28.71800s +00.00100s
|`->config-disable-ec2-metadata ran successfully @28.72000s +00.00000s
|`->config-runcmd ran successfully @28.72000s +00.00100s
|`->config-byobu ran successfully @28.72400s +00.00200s
Finished stage: (modules-config) 01.37000 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @29.36000s +00.00200s
|`->config-package-update-upgrade-install ran successfully @29.36200s +00.00100s
|`->config-fan ran successfully @29.36300s +00.00100s
|`->config-landscape ran successfully @29.36400s +00.00000s
|`->config-lxd ran successfully @29.36400s +00.00100s
|`->config-ubuntu-drivers ran successfully @29.36500s +00.00100s
|`->config-puppet ran successfully @29.36600s +00.00000s
|`->config-chef ran successfully @29.36700s +00.00000s
|`->config-mcollective ran successfully @29.36700s +00.00100s
|`->config-salt-minion ran successfully @29.36800s +00.00100s
|`->config-rightscale_userdata ran successfully @29.36900s +00.00000s
|`->config-scripts-vendor ran successfully @29.37000s +00.00000s
|`->config-scripts-per-once ran successfully @29.37000s +00.00100s
|`->config-scripts-per-boot ran successfully @29.37100s +00.00000s
|`->config-scripts-per-instance ran successfully @29.37100s +00.00100s
|`->config-scripts-user ran successfully @29.37200s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @29.37300s +00.00300s
|`->config-keys-to-console ran successfully @29.37600s +00.02900s
|`->config-phone-home ran successfully @29.40500s +00.00200s
|`->config-final-message ran successfully @29.40700s +00.00500s
|`->config-power-state-change ran successfully @29.41300s +00.00000s
Finished stage: (modules-final) 00.09100 seconds 

Total Time: 2.95400 seconds

1 boot records analyzed
-- Boot Record 01 --
     00.81000s (modules-config/config-ssh-import-id)
     00.38500s (init-network/config-ssh)
     00.30900s (modules-config/config-grub-dpkg)
     00.19600s (init-network/config-growpart)
     00.17900s (init-network/config-resizefs)
     00.11300s (modules-config/config-apt-configure)
     00.09800s (init-network/config-users-groups)
     00.08600s (modules-config/config-ntp)
     00.07200s (init-network/search-GCE)
     00.02900s (modules-final/config-keys-to-console)
     00.00800s (init-network/consume-user-data)
     00.00600s (init-network/config-set_hostname)
     00.00500s (modules-final/config-final-message)
     00.00300s (modules-final/config-ssh-authkey-fingerprints)
     00.00300s (init-network/activate-datasource)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-final/config-phone-home)
     00.00200s (modules-config/config-locale)
     00.00200s (modules-config/config-byobu)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-timezone)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-mounts)
     00.00100s (init-network/config-disk_setup)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/config-bootcmd)
     00.00000s (modules-final/config-scripts-vendor)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-rightscale_userdata)
     00.00000s (modules-final/config-puppet)
     00.00000s (modules-final/config-power-state-change)
     00.00000s (modules-final/config-landscape)
     00.00000s (modules-final/config-chef)
     00.00000s (modules-config/config-snap_config)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-update_etc_hosts)
     00.00000s (init-network/config-migrator)
     00.00000s (init-network/check-cache)
     00.00000s (init-local/check-cache)

1 boot records analyzed
Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        ens4:
            dhcp4: true
            match:
                macaddress: 42:01:0a:f0:00:40
            set-name: ens4
    version: 2
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu bionic-proposed/main amd64 cloud-init all 19.2-36-g059d049c-0ubuntu2~18.04.1 [404 kB]
Preparing to unpack .../cloud-init_19.2-36-g059d049c-0ubuntu2~18.04.1_all.deb ...
Unpacking cloud-init (19.2-36-g059d049c-0ubuntu2~18.04.1) over (19.2-36-g059d049c-0ubuntu1~18.04.1) ...
Setting up cloud-init (19.2-36-g059d049c-0ubuntu2~18.04.1) ...
cloud-init	19.2-36-g059d049c-0ubuntu2~18.04.1

status: done
time: Fri, 04 Oct 2019 20:06:55 +0000
detail:
DataSourceGCE
SRU-worked-gce
Startup finished in 2.847s (kernel) + 17.208s (userspace) = 20.056s
graphical.target reached after 13.384s in userspace
          2.785s snapd.service
          2.709s pollinate.service
          2.588s cloud-config.service
          2.101s dev-sda1.device
          1.922s keyboard-setup.service
          1.741s cloud-init-local.service
          1.657s accounts-daemon.service
          1.584s lxd-containers.service
          1.502s google-instance-setup.service
          1.360s snapd.seeded.service
          1.355s ssh.service
          1.329s systemd-networkd-wait-online.service
          1.311s cloud-init.service
          1.265s grub-common.service
          1.250s apport.service
          1.214s networkd-dispatcher.service
           923ms cloud-final.service
           730ms polkit.service
           724ms systemd-hostnamed.service
           706ms plymouth-quit.service
           691ms plymouth-quit-wait.service
           684ms setvtrgb.service
           482ms apparmor.service
           462ms lxd.socket
           440ms systemd-journal-flush.service
           366ms lvm2-monitor.service
           348ms systemd-update-utmp-runlevel.service
           346ms google-shutdown-scripts.service
           311ms snapd.socket
           301ms google-startup-scripts.service
           256ms systemd-logind.service
           251ms systemd-udev-trigger.service
           191ms systemd-user-sessions.service
           175ms systemd-remount-fs.service
           171ms ufw.service
           171ms dev-mqueue.mount
           148ms kmod-static-nodes.service
           144ms rsyslog.service
           143ms ebtables.service
           143ms sys-kernel-debug.mount
           135ms dev-hugepages.mount
           133ms systemd-modules-load.service
           119ms systemd-tmpfiles-setup-dev.service
           119ms systemd-sysctl.service
           119ms sys-fs-fuse-connections.mount
           119ms sys-kernel-config.mount
           118ms sshguard.service
           105ms systemd-networkd.service
           103ms systemd-random-seed.service
            97ms blk-availability.service
            94ms systemd-journald.service
            80ms boot-efi.mount
            79ms systemd-tmpfiles-setup.service
            79ms snap-core-7713.mount
            79ms plymouth-read-write.service
            77ms snap-google\x2dcloud\x2dsdk-101.mount
            75ms systemd-resolved.service
            74ms systemd-udevd.service
            63ms console-setup.service
            57ms chrony.service
            48ms dev-loop1.device
            47ms dev-loop0.device
            37ms user@1000.service
            28ms systemd-update-utmp.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00000s
Finished stage: (init-local) 00.22000 seconds 

Starting stage: init-network
|`->no cache found @02.27100s +00.00100s
|`->found network data from DataSourceGCE @02.29800s +00.05300s
|`->setting up datasource @02.53900s +00.00000s
|`->reading and applying user-data @02.55700s +00.00800s
|`->reading and applying vendor-data @02.56500s +00.00000s
|`->activating datasource @02.59300s +00.00100s
|`->config-migrator ran successfully @02.63800s +00.00100s
|`->config-seed_random ran successfully @02.63900s +00.00100s
|`->config-bootcmd ran successfully @02.64000s +00.00100s
|`->config-write-files ran successfully @02.64100s +00.00100s
|`->config-growpart ran successfully @02.64200s +00.08700s
|`->config-resizefs ran successfully @02.72900s +00.04800s
|`->config-disk_setup ran successfully @02.77700s +00.00200s
|`->config-mounts ran successfully @02.78100s +00.00200s
|`->config-set_hostname ran successfully @02.78300s +00.00500s
|`->config-update_hostname ran successfully @02.78900s +00.00100s
|`->config-update_etc_hosts ran successfully @02.79000s +00.00000s
|`->config-ca-certs ran successfully @02.79100s +00.00100s
|`->config-rsyslog ran successfully @02.79200s +00.00100s
|`->config-users-groups ran successfully @02.79300s +00.03900s
|`->config-ssh ran successfully @02.83200s +00.21000s
Finished stage: (init-network) 00.79000 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @09.42000s +00.00000s
|`->config-snap ran successfully @09.42100s +00.00000s
|`->config-snap_config ran successfully @09.42200s +00.00000s
|`->config-ssh-import-id ran successfully @09.42300s +00.84800s
|`->config-locale ran successfully @10.27100s +00.00200s
|`->config-set-passwords ran successfully @10.27300s +00.00100s
|`->config-grub-dpkg ran successfully @10.27400s +00.57600s
|`->config-apt-pipelining ran successfully @10.85100s +00.00100s
|`->config-apt-configure ran successfully @10.85200s +00.15100s
|`->config-ubuntu-advantage ran successfully @11.00400s +00.00100s
|`->config-ntp ran successfully @11.00500s +00.07900s
|`->config-timezone ran successfully @11.08400s +00.00200s
|`->config-disable-ec2-metadata ran successfully @11.08600s +00.00000s
|`->config-runcmd ran successfully @11.08600s +00.00100s
|`->config-byobu ran successfully @11.08700s +00.00100s
Finished stage: (modules-config) 01.75500 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @11.94600s +00.00200s
|`->config-package-update-upgrade-install ran successfully @11.94800s +00.00100s
|`->config-fan ran successfully @11.94900s +00.00100s
|`->config-landscape ran successfully @11.95000s +00.00100s
|`->config-lxd ran successfully @11.95100s +00.00000s
|`->config-ubuntu-drivers ran successfully @11.95200s +00.00000s
|`->config-puppet ran successfully @11.95200s +00.00100s
|`->config-chef ran successfully @11.95300s +00.00100s
|`->config-mcollective ran successfully @11.95400s +00.00000s
|`->config-salt-minion ran successfully @11.95500s +00.00000s
|`->config-rightscale_userdata ran successfully @11.95500s +00.00100s
|`->config-scripts-vendor ran successfully @11.95600s +00.00100s
|`->config-scripts-per-once ran successfully @11.95700s +00.00000s
|`->config-scripts-per-boot ran successfully @11.95800s +00.00000s
|`->config-scripts-per-instance ran successfully @11.95800s +00.00100s
|`->config-scripts-user ran successfully @11.95900s +00.00000s
|`->config-ssh-authkey-fingerprints ran successfully @11.95900s +00.00300s
|`->config-keys-to-console ran successfully @11.96200s +00.05500s
|`->config-phone-home ran successfully @12.01800s +00.00100s
|`->config-final-message ran successfully @12.01900s +00.00600s
|`->config-power-state-change ran successfully @12.02500s +00.00100s
Finished stage: (modules-final) 00.28600 seconds 

Total Time: 3.05100 seconds

1 boot records analyzed
-- Boot Record 01 --
     00.84800s (modules-config/config-ssh-import-id)
     00.57600s (modules-config/config-grub-dpkg)
     00.21000s (init-network/config-ssh)
     00.15100s (modules-config/config-apt-configure)
     00.08700s (init-network/config-growpart)
     00.07900s (modules-config/config-ntp)
     00.05500s (modules-final/config-keys-to-console)
     00.05300s (init-network/search-GCE)
     00.04800s (init-network/config-resizefs)
     00.03900s (init-network/config-users-groups)
     00.00800s (init-network/consume-user-data)
     00.00600s (modules-final/config-final-message)
     00.00500s (init-network/config-set_hostname)
     00.00300s (modules-final/config-ssh-authkey-fingerprints)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-config/config-timezone)
     00.00200s (modules-config/config-locale)
     00.00200s (init-network/config-mounts)
     00.00200s (init-network/config-disk_setup)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-byobu)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-network/config-bootcmd)
     00.00100s (init-network/check-cache)
     00.00100s (init-network/activate-datasource)
     00.00000s (modules-final/config-ubuntu-drivers)
     00.00000s (modules-final/config-scripts-user)
     00.00000s (modules-final/config-scripts-per-once)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-salt-minion)
     00.00000s (modules-final/config-mcollective)
     00.00000s (modules-final/config-lxd)
     00.00000s (modules-config/config-snap_config)
     00.00000s (modules-config/config-snap)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-update_etc_hosts)
     00.00000s (init-local/check-cache)

1 boot records analyzed
After upgrade Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        ens4:
            dhcp4: true
            match:
                macaddress: 42:01:0a:f0:00:40
            set-name: ens4
    version: 2
cloud-region: gce-us-central1
Get cloud-id
gce
Validating whether metadata is being updated per boot LP:1819913
2019-10-04 20:06:46,104 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot

status: done
time: Fri, 04 Oct 2019 20:07:45 +0000
detail:
DataSourceGCE
After reboot
2019-10-04 20:06:46,104 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-10-04 20:07:36,505 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
### BEGIN disco
NAME            ZONE           MACHINE_TYPE   PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP    STATUS
disco-sru-test  us-central1-b  n1-standard-1               10.240.0.62  35.226.88.196  RUNNING
............................................................................
status: done
time: Fri, 04 Oct 2019 20:01:48 +0000
detail:
DataSourceGCE
cloud-init	19.2-36-g059d049c-0ubuntu1~19.04.1
{
 "v1": {
  "datasource": "DataSourceGCE",
  "errors": []
 }
}
Startup finished in 1.117s (kernel) + 57.170s (userspace) = 58.287s 
graphical.target reached after 53.777s in userspace
         41.484s snapd.seeded.service
         11.044s pollinate.service
          2.564s cloud-init.service
          2.046s cloud-config.service
          1.996s systemd-networkd-wait-online.service
          1.586s cloud-init-local.service
          1.570s google-instance-setup.service
          1.568s lvm2-monitor.service
          1.539s dev-sda1.device
          1.497s systemd-logind.service
          1.166s systemd-udev-settle.service
          1.165s networkd-dispatcher.service
          1.016s snapd.service
           855ms apparmor.service
           765ms cloud-final.service
           552ms accounts-daemon.service
           550ms google-startup-scripts.service
           501ms plymouth-quit.service
           452ms systemd-journald.service
           433ms snapd.socket
           401ms plymouth-quit-wait.service
           395ms snap.lxd.activate.service
           394ms systemd-networkd.service
           381ms apport.service
           345ms rsyslog.service
           328ms systemd-resolved.service
           269ms grub-common.service
           240ms keyboard-setup.service
           175ms systemd-udev-trigger.service
           159ms systemd-sysusers.service
           141ms systemd-modules-load.service
           130ms sys-kernel-debug.mount
           130ms atd.service
           129ms blk-availability.service
           124ms systemd-user-sessions.service
           119ms sshguard.service
           118ms dev-mqueue.mount
           115ms user@1000.service
           114ms dev-hugepages.mount
           111ms systemd-remount-fs.service
           109ms systemd-sysctl.service
           108ms chrony.service
            95ms console-setup.service
            94ms kmod-static-nodes.service
            87ms systemd-udevd.service
            86ms systemd-tmpfiles-setup.service
            75ms multipathd.service
            73ms finalrd.service
            59ms systemd-machine-id-commit.service
            54ms grub-initrd-fallback.service
            50ms dev-loop2.device
            45ms plymouth-read-write.service
            43ms systemd-random-seed.service
            39ms dev-loop1.device
            39ms ssh.service
            39ms systemd-journal-flush.service
            39ms systemd-update-utmp.service
            36ms snap-core-7713.mount
            34ms snap-google\x2dcloud\x2dsdk-101.mount
            33ms google-shutdown-scripts.service
            33ms sys-kernel-config.mount
            32ms snap-lxd-11985.mount
            30ms systemd-tmpfiles-setup-dev.service
            30ms dev-loop0.device
            29ms sys-fs-fuse-connections.mount
            28ms ufw.service
            25ms boot-efi.mount
            23ms systemd-update-utmp-runlevel.service
            21ms user-runtime-dir@1000.service
            16ms setvtrgb.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00400s +00.00000s
Finished stage: (init-local) 00.18200 seconds 

Starting stage: init-network
|`->no cache found @03.19400s +00.00000s
|`->found network data from DataSourceGCE @03.20000s +00.10500s
|`->setting up datasource @03.53200s +00.00000s
|`->reading and applying user-data @03.54900s +00.01000s
|`->reading and applying vendor-data @03.55900s +00.00000s
|`->activating datasource @03.58700s +00.00200s
|`->config-migrator ran successfully @03.62700s +00.00100s
|`->config-seed_random ran successfully @03.62800s +00.00100s
|`->config-bootcmd ran successfully @03.62900s +00.00000s
|`->config-write-files ran successfully @03.62900s +00.00100s
|`->config-growpart ran successfully @03.63000s +00.53500s
|`->config-resizefs ran successfully @04.16600s +00.32200s
|`->config-disk_setup ran successfully @04.48800s +00.00200s
|`->config-mounts ran successfully @04.49000s +00.00200s
|`->config-set_hostname ran successfully @04.49200s +00.00800s
|`->config-update_hostname ran successfully @04.50100s +00.00100s
|`->config-update_etc_hosts ran successfully @04.50200s +00.00100s
|`->config-ca-certs ran successfully @04.50300s +00.00100s
|`->config-rsyslog ran successfully @04.50400s +00.00100s
|`->config-users-groups ran successfully @04.50500s +00.14300s
|`->config-ssh ran successfully @04.64800s +00.42300s
Finished stage: (init-network) 01.90700 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @49.46000s +00.00000s
|`->config-snap ran successfully @49.46000s +00.00100s
|`->config-snap_config ran successfully @49.46100s +00.00100s
|`->config-ssh-import-id ran successfully @49.46200s +00.85600s
|`->config-locale ran successfully @50.31900s +00.00200s
|`->config-set-passwords ran successfully @50.32100s +00.00100s
|`->config-grub-dpkg ran successfully @50.32200s +00.33800s
|`->config-apt-pipelining ran successfully @50.66100s +00.00200s
|`->config-apt-configure ran successfully @50.66300s +00.11500s
|`->config-ubuntu-advantage ran successfully @50.77800s +00.00100s
|`->config-ntp ran successfully @50.77900s +00.14200s
|`->config-timezone ran successfully @50.92200s +00.00200s
|`->config-disable-ec2-metadata ran successfully @50.92500s +00.00000s
|`->config-runcmd ran successfully @50.92500s +00.01000s
|`->config-byobu ran successfully @50.93500s +00.00100s
Finished stage: (modules-config) 01.50700 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @51.62700s +00.00200s
|`->config-package-update-upgrade-install ran successfully @51.62900s +00.00100s
|`->config-fan ran successfully @51.63100s +00.00000s
|`->config-landscape ran successfully @51.63200s +00.00000s
|`->config-lxd ran successfully @51.63200s +00.00100s
|`->config-ubuntu-drivers ran successfully @51.63300s +00.00100s
|`->config-puppet ran successfully @51.63400s +00.00000s
|`->config-chef ran successfully @51.63500s +00.00000s
|`->config-mcollective ran successfully @51.63500s +00.00100s
|`->config-salt-minion ran successfully @51.63600s +00.00100s
|`->config-rightscale_userdata ran successfully @51.63700s +00.00000s
|`->config-scripts-vendor ran successfully @51.63800s +00.00100s
|`->config-scripts-per-once ran successfully @51.63900s +00.00100s
|`->config-scripts-per-boot ran successfully @51.64000s +00.00000s
|`->config-scripts-per-instance ran successfully @51.64000s +00.00100s
|`->config-scripts-user ran successfully @51.64100s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @51.64200s +00.00400s
|`->config-keys-to-console ran successfully @51.64600s +00.03500s
|`->config-phone-home ran successfully @51.68100s +00.00200s
|`->config-final-message ran successfully @51.68400s +00.00600s
|`->config-power-state-change ran successfully @51.69100s +00.00000s
Finished stage: (modules-final) 00.11000 seconds 

Total Time: 3.70600 seconds

1 boot records analyzed
-- Boot Record 01 --
     00.85600s (modules-config/config-ssh-import-id)
     00.53500s (init-network/config-growpart)
     00.42300s (init-network/config-ssh)
     00.33800s (modules-config/config-grub-dpkg)
     00.32200s (init-network/config-resizefs)
     00.14300s (init-network/config-users-groups)
     00.14200s (modules-config/config-ntp)
     00.11500s (modules-config/config-apt-configure)
     00.10500s (init-network/search-GCE)
     00.03500s (modules-final/config-keys-to-console)
     00.01000s (modules-config/config-runcmd)
     00.01000s (init-network/consume-user-data)
     00.00800s (init-network/config-set_hostname)
     00.00600s (modules-final/config-final-message)
     00.00400s (modules-final/config-ssh-authkey-fingerprints)
     00.00200s (modules-final/config-snappy)
     00.00200s (modules-final/config-phone-home)
     00.00200s (modules-config/config-timezone)
     00.00200s (modules-config/config-locale)
     00.00200s (modules-config/config-apt-pipelining)
     00.00200s (init-network/config-mounts)
     00.00200s (init-network/config-disk_setup)
     00.00200s (init-network/activate-datasource)
     00.00100s (modules-final/config-ubuntu-drivers)
     00.00100s (modules-final/config-scripts-vendor)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-scripts-per-once)
     00.00100s (modules-final/config-scripts-per-instance)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-mcollective)
     00.00100s (modules-final/config-lxd)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-snap_config)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-byobu)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-update_hostname)
     00.00100s (init-network/config-update_etc_hosts)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-migrator)
     00.00100s (init-network/config-ca-certs)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-rightscale_userdata)
     00.00000s (modules-final/config-puppet)
     00.00000s (modules-final/config-power-state-change)
     00.00000s (modules-final/config-landscape)
     00.00000s (modules-final/config-fan)
     00.00000s (modules-final/config-chef)
     00.00000s (modules-config/config-emit_upstart)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/setup-datasource)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)
     00.00000s (init-local/check-cache)

1 boot records analyzed
Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        ens4:
            dhcp4: true
            match:
                macaddress: 42:01:0a:f0:00:3e
            set-name: ens4
    version: 2
  cloud-init
Get:1 http://archive.ubuntu.com/ubuntu disco-proposed/main amd64 cloud-init all 19.2-36-g059d049c-0ubuntu2~19.04.1 [401 kB]
Preparing to unpack .../cloud-init_19.2-36-g059d049c-0ubuntu2~19.04.1_all.deb ...
Unpacking cloud-init (19.2-36-g059d049c-0ubuntu2~19.04.1) over (19.2-36-g059d049c-0ubuntu1~19.04.1) ...
Setting up cloud-init (19.2-36-g059d049c-0ubuntu2~19.04.1) ...
cloud-init	19.2-36-g059d049c-0ubuntu2~19.04.1
........
status: done
time: Fri, 04 Oct 2019 20:02:53 +0000
detail:
DataSourceGCE
SRU-worked-gce
Startup finished in 1.055s (kernel) + 18.932s (userspace) = 19.987s 
graphical.target reached after 15.573s in userspace
          5.315s snap.lxd.activate.service
          4.119s cloud-config.service
          3.412s snapd.service
          2.624s google-instance-setup.service
          2.428s systemd-logind.service
          2.153s systemd-hostnamed.service
          1.990s cloud-init-local.service
          1.915s pollinate.service
          1.679s systemd-networkd-wait-online.service
          1.639s cloud-init.service
          1.616s dev-sda1.device
          1.520s lvm2-monitor.service
          1.411s networkd-dispatcher.service
          1.187s systemd-udev-settle.service
           678ms cloud-final.service
           625ms blk-availability.service
           530ms systemd-journald.service
           466ms apparmor.service
           457ms rsyslog.service
           377ms systemd-resolved.service
           375ms grub-common.service
           361ms systemd-networkd.service
           359ms user@1000.service
           336ms apport.service
           328ms google-startup-scripts.service
           284ms setvtrgb.service
           263ms keyboard-setup.service
           259ms accounts-daemon.service
           243ms systemd-udev-trigger.service
           202ms snapd.seeded.service
           176ms atd.service
           159ms systemd-journal-flush.service
           154ms snapd.socket
           150ms systemd-modules-load.service
           145ms systemd-user-sessions.service
           141ms sshguard.service
           133ms ufw.service
           132ms dev-loop1.device
           132ms dev-mqueue.mount
           130ms ssh.service
           128ms systemd-remount-fs.service
           125ms plymouth-quit-wait.service
           123ms sys-kernel-debug.mount
            99ms dev-hugepages.mount
            99ms dev-loop2.device
            94ms systemd-udevd.service
            88ms systemd-sysusers.service
            77ms plymouth-quit.service
            73ms kmod-static-nodes.service
            71ms multipathd.service
            66ms chrony.service
            58ms grub-initrd-fallback.service
            58ms systemd-tmpfiles-setup.service
            56ms systemd-sysctl.service
            48ms snap-lxd-11985.mount
            45ms systemd-update-utmp-runlevel.service
            41ms dev-loop0.device
            41ms snap-core-7713.mount
            38ms boot-efi.mount
            38ms snap-google\x2dcloud\x2dsdk-101.mount
            34ms user-runtime-dir@1000.service
            30ms console-setup.service
            29ms finalrd.service
            25ms plymouth-read-write.service
            24ms sys-fs-fuse-connections.mount
            23ms sys-kernel-config.mount
            23ms systemd-random-seed.service
            23ms systemd-tmpfiles-setup-dev.service
            12ms systemd-update-utmp.service
            11ms google-shutdown-scripts.service
-- Boot Record 01 --
The total time elapsed since completing an event is printed after the "@" character.
The time the event takes is printed after the "+" character.

Starting stage: init-local
|`->no cache found @00.00500s +00.00100s
Finished stage: (init-local) 00.28400 seconds 

Starting stage: init-network
|`->no cache found @03.01700s +00.00000s
|`->found network data from DataSourceGCE @03.02100s +00.06800s
|`->setting up datasource @03.31900s +00.00100s
|`->reading and applying user-data @03.34000s +00.01300s
|`->reading and applying vendor-data @03.35300s +00.00000s
|`->activating datasource @03.38400s +00.00200s
|`->config-migrator ran successfully @03.42400s +00.00000s
|`->config-seed_random ran successfully @03.42500s +00.00100s
|`->config-bootcmd ran successfully @03.42600s +00.00000s
|`->config-write-files ran successfully @03.42600s +00.00100s
|`->config-growpart ran successfully @03.42700s +00.14900s
|`->config-resizefs ran successfully @03.57700s +00.11300s
|`->config-disk_setup ran successfully @03.69100s +00.00100s
|`->config-mounts ran successfully @03.69200s +00.00200s
|`->config-set_hostname ran successfully @03.69400s +00.00900s
|`->config-update_hostname ran successfully @03.70300s +00.00200s
|`->config-update_etc_hosts ran successfully @03.70500s +00.00000s
|`->config-ca-certs ran successfully @03.70500s +00.00100s
|`->config-rsyslog ran successfully @03.70600s +00.00100s
|`->config-users-groups ran successfully @03.70700s +00.06300s
|`->config-ssh ran successfully @03.77100s +00.19900s
Finished stage: (init-network) 00.98800 seconds 

Starting stage: modules-config
|`->config-emit_upstart ran successfully @12.13900s +00.00100s
|`->config-snap ran successfully @12.14000s +00.00100s
|`->config-snap_config ran successfully @12.14100s +00.00000s
|`->config-ssh-import-id ran successfully @12.14200s +00.91000s
|`->config-locale ran successfully @13.05300s +00.00100s
|`->config-set-passwords ran successfully @13.05400s +00.00100s
|`->config-grub-dpkg ran successfully @13.05500s +00.41600s
|`->config-apt-pipelining ran successfully @13.47200s +00.00100s
|`->config-apt-configure ran successfully @13.47300s +00.11200s
|`->config-ubuntu-advantage ran successfully @13.58600s +00.00100s
|`->config-ntp ran successfully @13.58700s +00.11000s
|`->config-timezone ran successfully @13.69800s +00.00300s
|`->config-disable-ec2-metadata ran successfully @13.70200s +00.00000s
|`->config-runcmd ran successfully @13.70200s +00.00100s
|`->config-byobu ran successfully @13.70300s +00.00700s
Finished stage: (modules-config) 02.84300 seconds 

Starting stage: modules-final
|`->config-snappy ran successfully @14.36700s +00.00200s
|`->config-package-update-upgrade-install ran successfully @14.36900s +00.00100s
|`->config-fan ran successfully @14.37000s +00.00100s
|`->config-landscape ran successfully @14.37100s +00.00100s
|`->config-lxd ran successfully @14.37200s +00.00000s
|`->config-ubuntu-drivers ran successfully @14.37300s +00.00000s
|`->config-puppet ran successfully @14.37300s +00.00100s
|`->config-chef ran successfully @14.37400s +00.00100s
|`->config-mcollective ran successfully @14.37500s +00.00000s
|`->config-salt-minion ran successfully @14.37500s +00.00100s
|`->config-rightscale_userdata ran successfully @14.37600s +00.00100s
|`->config-scripts-vendor ran successfully @14.37700s +00.00000s
|`->config-scripts-per-once ran successfully @14.37800s +00.00000s
|`->config-scripts-per-boot ran successfully @14.37800s +00.00000s
|`->config-scripts-per-instance ran successfully @14.37900s +00.00000s
|`->config-scripts-user ran successfully @14.37900s +00.00100s
|`->config-ssh-authkey-fingerprints ran successfully @14.38000s +00.00300s
|`->config-keys-to-console ran successfully @14.38400s +00.04500s
|`->config-phone-home ran successfully @14.43000s +00.00100s
|`->config-final-message ran successfully @14.43100s +00.00700s
|`->config-power-state-change ran successfully @14.43800s +00.00100s
Finished stage: (modules-final) 00.13300 seconds 

Total Time: 4.24800 seconds

1 boot records analyzed
-- Boot Record 01 --
     00.91000s (modules-config/config-ssh-import-id)
     00.41600s (modules-config/config-grub-dpkg)
     00.19900s (init-network/config-ssh)
     00.14900s (init-network/config-growpart)
     00.11300s (init-network/config-resizefs)
     00.11200s (modules-config/config-apt-configure)
     00.11000s (modules-config/config-ntp)
     00.06800s (init-network/search-GCE)
     00.06300s (init-network/config-users-groups)
     00.04500s (modules-final/config-keys-to-console)
     00.01300s (init-network/consume-user-data)
     00.00900s (init-network/config-set_hostname)
     00.00700s (modules-final/config-final-message)
     00.00700s (modules-config/config-byobu)
     00.00300s (modules-final/config-ssh-authkey-fingerprints)
     00.00300s (modules-config/config-timezone)
     00.00200s (modules-final/config-snappy)
     00.00200s (init-network/config-update_hostname)
     00.00200s (init-network/config-mounts)
     00.00200s (init-network/activate-datasource)
     00.00100s (modules-final/config-scripts-user)
     00.00100s (modules-final/config-salt-minion)
     00.00100s (modules-final/config-rightscale_userdata)
     00.00100s (modules-final/config-puppet)
     00.00100s (modules-final/config-power-state-change)
     00.00100s (modules-final/config-phone-home)
     00.00100s (modules-final/config-package-update-upgrade-install)
     00.00100s (modules-final/config-landscape)
     00.00100s (modules-final/config-fan)
     00.00100s (modules-final/config-chef)
     00.00100s (modules-config/config-ubuntu-advantage)
     00.00100s (modules-config/config-snap)
     00.00100s (modules-config/config-set-passwords)
     00.00100s (modules-config/config-runcmd)
     00.00100s (modules-config/config-locale)
     00.00100s (modules-config/config-emit_upstart)
     00.00100s (modules-config/config-apt-pipelining)
     00.00100s (init-network/setup-datasource)
     00.00100s (init-network/config-write-files)
     00.00100s (init-network/config-seed_random)
     00.00100s (init-network/config-rsyslog)
     00.00100s (init-network/config-disk_setup)
     00.00100s (init-network/config-ca-certs)
     00.00100s (init-local/check-cache)
     00.00000s (modules-final/config-ubuntu-drivers)
     00.00000s (modules-final/config-scripts-vendor)
     00.00000s (modules-final/config-scripts-per-once)
     00.00000s (modules-final/config-scripts-per-instance)
     00.00000s (modules-final/config-scripts-per-boot)
     00.00000s (modules-final/config-mcollective)
     00.00000s (modules-final/config-lxd)
     00.00000s (modules-config/config-snap_config)
     00.00000s (modules-config/config-disable-ec2-metadata)
     00.00000s (init-network/consume-vendor-data)
     00.00000s (init-network/config-update_etc_hosts)
     00.00000s (init-network/config-migrator)
     00.00000s (init-network/config-bootcmd)
     00.00000s (init-network/check-cache)

1 boot records analyzed
After upgrade Networking config
# This file is generated from information provided by
# the datasource.  Changes to it will not persist across an instance.
# To disable cloud-init's network configuration capabilities, write a file
# /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:
# network: {config: disabled}
network:
    ethernets:
        ens4:
            dhcp4: true
            match:
                macaddress: 42:01:0a:f0:00:3e
            set-name: ens4
    version: 2
cloud-region: gce-us-central1
Get cloud-id
gce
Validating whether metadata is being updated per boot LP:1819913
2019-10-04 20:02:42,026 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
..
status: done
time: Fri, 04 Oct 2019 20:03:35 +0000
detail:
DataSourceGCE
After reboot
2019-10-04 20:02:42,026 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
2019-10-04 20:03:27,022 - __init__.py[DEBUG]: Update datasource metadata and network config due to events: New instance first boot
