https://github.com/canonical/cloud-init/commit/02db2c3e

=== Begin SRU Template ===
[Impact]
This commit fixes an exception that was raised when the 'chef_license'
key was specified.

[Test Case]
This was tested with a test found in the following (unmerged) commit:
https://github.com/TheRealFalcon/cloud-init/commit/806eb1e108a62784a595f611abc4864888dcc64b

https://github.com/TheRealFalcon/cloud-init/blob/806eb1e108a62784a595f611abc4864888dcc64b/tests/integration_tests/bugs/test_gh868.py

=== Bionic ===
============================= test session starts ==============================
platform linux -- Python 3.5.10, pytest-6.1.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/james/cloud-init-tests, configfile: tox.ini
plugins: cov-2.11.1
collected 1 item

tests/integration_tests/bugs/test_gh868.py::test_chef_license Detected image: image_id=bionic os=ubuntu release=bionic

-------------------------------- live log setup --------------------------------
2021-05-14 20:51:42 INFO      integration_testing:clouds.py:88 Detected image: image_id=bionic os=ubuntu release=bionic
Detected image: image_id=bionic os=ubuntu release=bionic
2021-05-14 20:51:42 INFO      integration_testing:clouds.py:88 Detected image: image_id=bionic os=ubuntu release=bionic
Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=bionic
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
2021-05-14 20:51:48 INFO      integration_testing:clouds.py:129 Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=bionic
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
Setting up environment for lxd_vm
2021-05-14 20:51:48 INFO      integration_testing:conftest.py:156 Setting up environment for lxd_vm
Launching instance with launch_kwargs:
user_data=None
image_id=ubuntu:4fb318cb190fc599b788584d5088c8a64bb32bbc5d8a429cac60263bddf4c7f5
2021-05-14 20:51:48 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
user_data=None
image_id=ubuntu:4fb318cb190fc599b788584d5088c8a64bb32bbc5d8a429cac60263bddf4c7f5
The profile named pycloudlib-vm-bionic-v2 already exists
['lxc', 'init', 'ubuntu:4fb318cb190fc599b788584d5088c8a64bb32bbc5d8a429cac60263bddf4c7f5', '--profile', 'pycloudlib-vm-bionic-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--vm']
2021-05-14 20:51:51 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 20:52:15 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.65
Retrying SSH connection to ubuntu@10.37.179.65:22 (576s left)
2021-05-14 20:52:16 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.65
Retrying SSH connection to ubuntu@10.37.179.65:22 (575s left)
2021-05-14 20:52:17 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.65
Retrying SSH connection to ubuntu@10.37.179.65:22 (573s left)
2021-05-14 20:52:18 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_7.6p1)
2021-05-14 20:52:18 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 20:52:19 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=gentle-troll)
2021-05-14 20:52:23 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=gentle-troll)
2021-05-14 20:52:23 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
2021-05-14 20:52:23 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_7.6p1)
2021-05-14 20:52:23 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 20:52:24 ERROR     paramiko.transport:transport.py:1819 Socket exception: Connection reset by peer (104)
2021-05-14 20:52:25 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.65
Retrying SSH connection to ubuntu@10.37.179.65:22 (598s left)
2021-05-14 20:52:57 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_7.6p1)
2021-05-14 20:52:58 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~18.04.2
2021-05-14 20:52:58 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~18.04.2
2021-05-14 20:52:58 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210512
2021-05-14 20:52:58 INFO      integration_testing:clouds.py:183 image serial: 20210512
Installing proposed image
2021-05-14 20:52:58 INFO      integration_testing:instances.py:144 Installing proposed image
2021-05-14 20:52:58 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'echo deb "http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-proposed main" | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init'
2021-05-14 20:53:11 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init -v'
Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~18.04.1
2021-05-14 20:53:12 INFO      integration_testing:instances.py:136 Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~18.04.1
2021-05-14 20:53:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 20:53:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 20:53:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 20:53:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 20:53:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 20:53:13 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
Created new image: local:gentle-troll-snapshot
2021-05-14 20:54:26 INFO      integration_testing:instances.py:113 Created new image: local:gentle-troll-snapshot
Done with environment setup
2021-05-14 20:54:26 INFO      integration_testing:conftest.py:162 Done with environment setup
Launching instance with launch_kwargs:
user_data=#cloud-config
chef:
  install_type: omnibus
  chef_license: accept
  server_url: https://chef.yourorg.invalid
  validation_name: some-validator

image_id=local:gentle-troll-snapshot
2021-05-14 20:54:26 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
user_data=#cloud-config
chef:
  install_type: omnibus
  chef_license: accept
  server_url: https://chef.yourorg.invalid
  validation_name: some-validator

image_id=local:gentle-troll-snapshot
['lxc', 'init', 'local:gentle-troll-snapshot', '--profile', 'pycloudlib-vm-bionic-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--config', 'user.user-data=#cloud-config\nchef:\n  install_type: omnibus\n  chef_license: accept\n  server_url: https://chef.yourorg.invalid\n  validation_name: some-validator\n', '--vm']
2021-05-14 20:55:29 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 20:56:17 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.56
Retrying SSH connection to ubuntu@10.37.179.56:22 (552s left)
2021-05-14 20:56:18 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.56
Retrying SSH connection to ubuntu@10.37.179.56:22 (550s left)
2021-05-14 20:56:19 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_7.6p1)
2021-05-14 20:56:19 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 20:56:20 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=guided-cricket)
2021-05-14 20:56:30 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=guided-cricket)
2021-05-14 20:56:30 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~18.04.1
2021-05-14 20:56:31 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~18.04.1
2021-05-14 20:56:31 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210512
2021-05-14 20:56:31 INFO      integration_testing:clouds.py:183 image serial: 20210512
-------------------------------- live log call ---------------------------------
2021-05-14 20:56:31 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/cloud-init.log'
PASSED
------------------------------ live log teardown -------------------------------
2021-05-14 20:56:31 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init collect-logs -u -t /var/tmp/cloud-init.tar.gz'
Writing logs to /tmp/cloud_init_test_logs/210514155142/tests/integration_tests/bugs/test_gh868/test_chef_license
2021-05-14 20:56:31 INFO      integration_testing:conftest.py:192 Writing logs to /tmp/cloud_init_test_logs/210514155142/tests/integration_tests/bugs/test_gh868/test_chef_license
2021-05-14 20:56:31 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'cp /var/tmp/cloud-init.tar.gz /var/tmp/5642dcd9-5deb-4928-96c1-9a11fbf66339.tmp'
2021-05-14 20:56:31 INFO      paramiko.transport.sftp:sftp.py:158 [chan 7] Opened sftp connection (server version 3)
Deleting snapshot image created for this testrun: local:gentle-troll-snapshot
2021-05-14 20:56:32 INFO      integration_testing:clouds.py:204 Deleting snapshot image created for this testrun: local:gentle-troll-snapshot


=============================== warnings summary ===============================
../envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8
  /home/james/envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8: CryptographyDeprecationWarning: Python 3.5 support will be dropped in the next release of cryptography. Please upgrade your Python.
    from cryptography.hazmat.primitives.asymmetric.utils import (

tests/integration_tests/bugs/test_gh868.py::test_chef_license
  /home/james/envs/cloud-init/lib/python3.5/site-packages/simplestreams/mirrors/__init__.py:207: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
    self.prefix, path)

-- Docs: https://docs.pytest.org/en/stable/warnings.html
================== 1 passed, 2 warnings in 290.31s (0:04:50) ===================


=== Focal ===
============================= test session starts ==============================
platform linux -- Python 3.5.10, pytest-6.1.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/james/cloud-init-tests, configfile: tox.ini
plugins: cov-2.11.1
collected 1 item

tests/integration_tests/bugs/test_gh868.py::test_chef_license Detected image: image_id=focal os=ubuntu release=focal

-------------------------------- live log setup --------------------------------
2021-05-14 21:16:26 INFO      integration_testing:clouds.py:88 Detected image: image_id=focal os=ubuntu release=focal
Detected image: image_id=focal os=ubuntu release=focal
2021-05-14 21:16:26 INFO      integration_testing:clouds.py:88 Detected image: image_id=focal os=ubuntu release=focal
Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=focal
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
2021-05-14 21:16:32 INFO      integration_testing:clouds.py:129 Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=focal
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
Setting up environment for lxd_vm
2021-05-14 21:16:32 INFO      integration_testing:conftest.py:156 Setting up environment for lxd_vm
Launching instance with launch_kwargs:
image_id=ubuntu:f217de8a505d919f42cac6a898ac66fdf582b8ccc092d73189b46101615f3612
user_data=None
2021-05-14 21:16:32 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
image_id=ubuntu:f217de8a505d919f42cac6a898ac66fdf582b8ccc092d73189b46101615f3612
user_data=None
The profile named pycloudlib-vm-focal-v2 already exists
['lxc', 'init', 'ubuntu:f217de8a505d919f42cac6a898ac66fdf582b8ccc092d73189b46101615f3612', '--profile', 'pycloudlib-vm-focal-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--vm']
2021-05-14 21:16:35 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 21:16:56 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.165
Retrying SSH connection to ubuntu@10.37.179.165:22 (578s left)
2021-05-14 21:16:58 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.165
Retrying SSH connection to ubuntu@10.37.179.165:22 (577s left)
2021-05-14 21:16:59 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.165
Retrying SSH connection to ubuntu@10.37.179.165:22 (575s left)
2021-05-14 21:17:00 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.2p1)
2021-05-14 21:17:00 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 21:17:03 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=sought-puma)
2021-05-14 21:17:09 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=sought-puma)
2021-05-14 21:17:09 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~20.04.2
2021-05-14 21:17:09 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~20.04.2
2021-05-14 21:17:09 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210510
2021-05-14 21:17:09 INFO      integration_testing:clouds.py:183 image serial: 20210510
Installing proposed image
2021-05-14 21:17:09 INFO      integration_testing:instances.py:144 Installing proposed image
2021-05-14 21:17:09 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'echo deb "http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-proposed main" | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init'
2021-05-14 21:17:24 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init -v'
Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~20.04.1
2021-05-14 21:17:25 INFO      integration_testing:instances.py:136 Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~20.04.1
2021-05-14 21:17:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:17:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 21:17:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:17:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 21:17:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:17:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
Created new image: local:sought-puma-snapshot
2021-05-14 21:18:50 INFO      integration_testing:instances.py:113 Created new image: local:sought-puma-snapshot
Done with environment setup
2021-05-14 21:18:50 INFO      integration_testing:conftest.py:162 Done with environment setup
Launching instance with launch_kwargs:
image_id=local:sought-puma-snapshot
user_data=#cloud-config
chef:
  install_type: omnibus
  chef_license: accept
  server_url: https://chef.yourorg.invalid
  validation_name: some-validator

2021-05-14 21:18:50 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
image_id=local:sought-puma-snapshot
user_data=#cloud-config
chef:
  install_type: omnibus
  chef_license: accept
  server_url: https://chef.yourorg.invalid
  validation_name: some-validator

['lxc', 'init', 'local:sought-puma-snapshot', '--profile', 'pycloudlib-vm-focal-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--config', 'user.user-data=#cloud-config\nchef:\n  install_type: omnibus\n  chef_license: accept\n  server_url: https://chef.yourorg.invalid\n  validation_name: some-validator\n', '--vm']
2021-05-14 21:20:00 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 21:20:19 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.122
Retrying SSH connection to ubuntu@10.37.179.122:22 (581s left)
2021-05-14 21:20:20 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.122
Retrying SSH connection to ubuntu@10.37.179.122:22 (579s left)
2021-05-14 21:20:22 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.2p1)
2021-05-14 21:20:22 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 21:20:23 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=hopeful-marlin)
2021-05-14 21:20:34 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=hopeful-marlin)
2021-05-14 21:20:34 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~20.04.1
2021-05-14 21:20:34 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~20.04.1
2021-05-14 21:20:34 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210510
2021-05-14 21:20:34 INFO      integration_testing:clouds.py:183 image serial: 20210510
-------------------------------- live log call ---------------------------------
2021-05-14 21:20:34 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/cloud-init.log'
PASSED
------------------------------ live log teardown -------------------------------
2021-05-14 21:20:34 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init collect-logs -u -t /var/tmp/cloud-init.tar.gz'
Writing logs to /tmp/cloud_init_test_logs/210514161626/tests/integration_tests/bugs/test_gh868/test_chef_license
2021-05-14 21:20:35 INFO      integration_testing:conftest.py:192 Writing logs to /tmp/cloud_init_test_logs/210514161626/tests/integration_tests/bugs/test_gh868/test_chef_license
2021-05-14 21:20:35 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'cp /var/tmp/cloud-init.tar.gz /var/tmp/c71353f3-6aa7-435d-943c-37a49eb8b67c.tmp'
2021-05-14 21:20:35 INFO      paramiko.transport.sftp:sftp.py:158 [chan 7] Opened sftp connection (server version 3)
Deleting snapshot image created for this testrun: local:sought-puma-snapshot
2021-05-14 21:20:35 INFO      integration_testing:clouds.py:204 Deleting snapshot image created for this testrun: local:sought-puma-snapshot


=============================== warnings summary ===============================
../envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8
  /home/james/envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8: CryptographyDeprecationWarning: Python 3.5 support will be dropped in the next release of cryptography. Please upgrade your Python.
    from cryptography.hazmat.primitives.asymmetric.utils import (

tests/integration_tests/bugs/test_gh868.py::test_chef_license
  /home/james/envs/cloud-init/lib/python3.5/site-packages/simplestreams/mirrors/__init__.py:207: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
    self.prefix, path)

-- Docs: https://docs.pytest.org/en/stable/warnings.html
================== 1 passed, 2 warnings in 249.68s (0:04:09) ===================


=== Groovy ===
============================= test session starts ==============================
platform linux -- Python 3.5.10, pytest-6.1.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/james/cloud-init-tests, configfile: tox.ini
plugins: cov-2.11.1
collected 1 item

tests/integration_tests/bugs/test_gh868.py::test_chef_license Detected image: image_id=groovy os=ubuntu release=groovy

-------------------------------- live log setup --------------------------------
2021-05-14 21:35:26 INFO      integration_testing:clouds.py:88 Detected image: image_id=groovy os=ubuntu release=groovy
Detected image: image_id=groovy os=ubuntu release=groovy
2021-05-14 21:35:26 INFO      integration_testing:clouds.py:88 Detected image: image_id=groovy os=ubuntu release=groovy
Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=groovy
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
2021-05-14 21:35:32 INFO      integration_testing:clouds.py:129 Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=groovy
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
Setting up environment for lxd_vm
2021-05-14 21:35:32 INFO      integration_testing:conftest.py:156 Setting up environment for lxd_vm
Launching instance with launch_kwargs:
user_data=None
image_id=ubuntu:982a39044cfe9c5372e65bb762453f2a34b339e26cef3d817b59f46c6e55c2b0
2021-05-14 21:35:32 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
user_data=None
image_id=ubuntu:982a39044cfe9c5372e65bb762453f2a34b339e26cef3d817b59f46c6e55c2b0
The profile named pycloudlib-vm-groovy-v2 already exists
['lxc', 'init', 'ubuntu:982a39044cfe9c5372e65bb762453f2a34b339e26cef3d817b59f46c6e55c2b0', '--profile', 'pycloudlib-vm-groovy-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--vm']
2021-05-14 21:35:35 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 21:35:56 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.235
Retrying SSH connection to ubuntu@10.37.179.235:22 (579s left)
2021-05-14 21:35:57 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.235
Retrying SSH connection to ubuntu@10.37.179.235:22 (577s left)
2021-05-14 21:35:59 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.235
Retrying SSH connection to ubuntu@10.37.179.235:22 (576s left)
2021-05-14 21:36:00 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.235
Retrying SSH connection to ubuntu@10.37.179.235:22 (574s left)
2021-05-14 21:36:02 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.3p1)
2021-05-14 21:36:02 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 21:36:03 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=devoted-platypus)
2021-05-14 21:36:07 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=devoted-platypus)
2021-05-14 21:36:07 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~20.10.2
2021-05-14 21:36:08 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~20.10.2
2021-05-14 21:36:08 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210511.1
2021-05-14 21:36:08 INFO      integration_testing:clouds.py:183 image serial: 20210511.1
Installing proposed image
2021-05-14 21:36:08 INFO      integration_testing:instances.py:144 Installing proposed image
2021-05-14 21:36:08 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'echo deb "http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-proposed main" | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init'
2021-05-14 21:36:23 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init -v'
Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~20.10.1
2021-05-14 21:36:23 INFO      integration_testing:instances.py:136 Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~20.10.1
2021-05-14 21:36:23 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:36:23 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 21:36:23 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:36:23 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 21:36:23 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:36:24 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
Created new image: local:devoted-platypus-snapshot
2021-05-14 21:37:55 INFO      integration_testing:instances.py:113 Created new image: local:devoted-platypus-snapshot
Done with environment setup
2021-05-14 21:37:55 INFO      integration_testing:conftest.py:162 Done with environment setup
Launching instance with launch_kwargs:
user_data=#cloud-config
chef:
  install_type: omnibus
  chef_license: accept
  server_url: https://chef.yourorg.invalid
  validation_name: some-validator

image_id=local:devoted-platypus-snapshot
2021-05-14 21:37:55 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
user_data=#cloud-config
chef:
  install_type: omnibus
  chef_license: accept
  server_url: https://chef.yourorg.invalid
  validation_name: some-validator

image_id=local:devoted-platypus-snapshot
['lxc', 'init', 'local:devoted-platypus-snapshot', '--profile', 'pycloudlib-vm-groovy-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--config', 'user.user-data=#cloud-config\nchef:\n  install_type: omnibus\n  chef_license: accept\n  server_url: https://chef.yourorg.invalid\n  validation_name: some-validator\n', '--vm']
2021-05-14 21:39:00 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 21:39:20 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.245
Retrying SSH connection to ubuntu@10.37.179.245:22 (580s left)
2021-05-14 21:39:22 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.3p1)
2021-05-14 21:39:22 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 21:39:23 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=wealthy-leopard)
2021-05-14 21:39:32 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=wealthy-leopard)
2021-05-14 21:39:32 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~20.10.1
2021-05-14 21:39:33 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~20.10.1
2021-05-14 21:39:33 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210511.1
2021-05-14 21:39:33 INFO      integration_testing:clouds.py:183 image serial: 20210511.1
-------------------------------- live log call ---------------------------------
2021-05-14 21:39:33 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/cloud-init.log'
PASSED
------------------------------ live log teardown -------------------------------
2021-05-14 21:39:33 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init collect-logs -u -t /var/tmp/cloud-init.tar.gz'
Writing logs to /tmp/cloud_init_test_logs/210514163526/tests/integration_tests/bugs/test_gh868/test_chef_license
2021-05-14 21:39:33 INFO      integration_testing:conftest.py:192 Writing logs to /tmp/cloud_init_test_logs/210514163526/tests/integration_tests/bugs/test_gh868/test_chef_license
2021-05-14 21:39:33 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'cp /var/tmp/cloud-init.tar.gz /var/tmp/9cfc4ee9-9c32-41d2-97ac-5d8610084737.tmp'
2021-05-14 21:39:33 INFO      paramiko.transport.sftp:sftp.py:158 [chan 7] Opened sftp connection (server version 3)
Deleting snapshot image created for this testrun: local:devoted-platypus-snapshot
2021-05-14 21:39:34 INFO      integration_testing:clouds.py:204 Deleting snapshot image created for this testrun: local:devoted-platypus-snapshot


=============================== warnings summary ===============================
../envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8
  /home/james/envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8: CryptographyDeprecationWarning: Python 3.5 support will be dropped in the next release of cryptography. Please upgrade your Python.
    from cryptography.hazmat.primitives.asymmetric.utils import (

tests/integration_tests/bugs/test_gh868.py::test_chef_license
  /home/james/envs/cloud-init/lib/python3.5/site-packages/simplestreams/mirrors/__init__.py:207: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
    self.prefix, path)

-- Docs: https://docs.pytest.org/en/stable/warnings.html
================== 1 passed, 2 warnings in 248.01s (0:04:08) ===================


=== Hirsute ===
============================= test session starts ==============================
platform linux -- Python 3.5.10, pytest-6.1.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/james/cloud-init-tests, configfile: tox.ini
plugins: cov-2.11.1
collected 1 item

tests/integration_tests/bugs/test_gh868.py::test_chef_license Detected image: image_id=hirsute os=ubuntu release=hirsute

-------------------------------- live log setup --------------------------------
2021-05-17 16:58:49 INFO      integration_testing:clouds.py:88 Detected image: image_id=hirsute os=ubuntu release=hirsute
Detected image: image_id=hirsute os=ubuntu release=hirsute
2021-05-17 16:58:49 INFO      integration_testing:clouds.py:88 Detected image: image_id=hirsute os=ubuntu release=hirsute
Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=hirsute
PLATFORM=lxd_container
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
2021-05-17 16:58:55 INFO      integration_testing:clouds.py:129 Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=hirsute
PLATFORM=lxd_container
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
Setting up environment for lxd_container
2021-05-17 16:58:55 INFO      integration_testing:conftest.py:156 Setting up environment for lxd_container
Launching instance with launch_kwargs:
user_data=None
image_id=ubuntu:8adad13e1e1185af6ad9efc0e8e9129cdd9d11d04a2751c140ecb94825048ad7
2021-05-17 16:58:55 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
user_data=None
image_id=ubuntu:8adad13e1e1185af6ad9efc0e8e9129cdd9d11d04a2751c140ecb94825048ad7
['lxc', 'init', 'ubuntu:8adad13e1e1185af6ad9efc0e8e9129cdd9d11d04a2751c140ecb94825048ad7', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n']
2021-05-17 16:59:00 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-17 16:59:02 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.253.153.61
Retrying SSH connection to ubuntu@10.253.153.61:22 (597s left)
2021-05-17 16:59:03 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.4p1)
2021-05-17 16:59:03 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-17 16:59:03 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=frank-peacock)
2021-05-17 16:59:08 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=frank-peacock)
2021-05-17 16:59:08 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu3
2021-05-17 16:59:08 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu3
2021-05-17 16:59:08 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210513
2021-05-17 16:59:08 INFO      integration_testing:clouds.py:183 image serial: 20210513
Installing proposed image
2021-05-17 16:59:08 INFO      integration_testing:instances.py:144 Installing proposed image
2021-05-17 16:59:08 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'echo deb "http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-proposed main" | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init'
2021-05-17 16:59:24 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init -v'
Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~21.04.1
2021-05-17 16:59:25 INFO      integration_testing:instances.py:136 Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~21.04.1
2021-05-17 16:59:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-17 16:59:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-17 16:59:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-17 16:59:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-17 16:59:25 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-17 16:59:26 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
Created new image: local:frank-peacock-snapshot
2021-05-17 17:00:15 INFO      integration_testing:instances.py:113 Created new image: local:frank-peacock-snapshot
Done with environment setup
2021-05-17 17:00:15 INFO      integration_testing:conftest.py:162 Done with environment setup
Launching instance with launch_kwargs:
user_data=#cloud-config
chef:
  install_type: omnibus
  chef_license: accept
  server_url: https://chef.yourorg.invalid
  validation_name: some-validator

image_id=local:frank-peacock-snapshot
2021-05-17 17:00:15 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
user_data=#cloud-config
chef:
  install_type: omnibus
  chef_license: accept
  server_url: https://chef.yourorg.invalid
  validation_name: some-validator

image_id=local:frank-peacock-snapshot
['lxc', 'init', 'local:frank-peacock-snapshot', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--config', 'user.user-data=#cloud-config\nchef:\n  install_type: omnibus\n  chef_license: accept\n  server_url: https://chef.yourorg.invalid\n  validation_name: some-validator\n']
2021-05-17 17:00:33 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-17 17:00:34 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.253.153.198
Retrying SSH connection to ubuntu@10.253.153.198:22 (598s left)
2021-05-17 17:00:35 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.253.153.198
Retrying SSH connection to ubuntu@10.253.153.198:22 (597s left)
2021-05-17 17:00:36 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.4p1)
2021-05-17 17:00:36 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-17 17:00:37 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=fine-guppy)
2021-05-17 17:01:14 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=fine-guppy)
2021-05-17 17:01:14 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~21.04.1
2021-05-17 17:01:14 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~21.04.1
2021-05-17 17:01:14 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210513
2021-05-17 17:01:14 INFO      integration_testing:clouds.py:183 image serial: 20210513
-------------------------------- live log call ---------------------------------
2021-05-17 17:01:14 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/cloud-init.log'
PASSED
------------------------------ live log teardown -------------------------------
2021-05-17 17:01:14 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init collect-logs -u -t /var/tmp/cloud-init.tar.gz'
Writing logs to /tmp/cloud_init_test_logs/210517115849/tests/integration_tests/bugs/test_gh868/test_chef_license
2021-05-17 17:01:15 INFO      integration_testing:conftest.py:192 Writing logs to /tmp/cloud_init_test_logs/210517115849/tests/integration_tests/bugs/test_gh868/test_chef_license
2021-05-17 17:01:15 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'cp /var/tmp/cloud-init.tar.gz /var/tmp/3cb5def6-e066-4c41-aacc-4dfa67cf8469.tmp'
2021-05-17 17:01:15 INFO      paramiko.transport.sftp:sftp.py:158 [chan 7] Opened sftp connection (server version 3)
Deleting snapshot image created for this testrun: local:frank-peacock-snapshot
2021-05-17 17:01:19 INFO      integration_testing:clouds.py:204 Deleting snapshot image created for this testrun: local:frank-peacock-snapshot


=============================== warnings summary ===============================
../envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8
  /home/james/envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8: CryptographyDeprecationWarning: Python 3.5 support will be dropped in the next release of cryptography. Please upgrade your Python.
    from cryptography.hazmat.primitives.asymmetric.utils import (

tests/integration_tests/bugs/test_gh868.py::test_chef_license
  /home/james/envs/cloud-init/lib/python3.5/site-packages/simplestreams/mirrors/__init__.py:207: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
    self.prefix, path)

-- Docs: https://docs.pytest.org/en/stable/warnings.html
================== 1 passed, 2 warnings in 150.31s (0:02:30) ===================


[Regression Potential]
Given that the 'chef_license' key was already broken, any possible
regression here would amount to the behavior still being broken.
