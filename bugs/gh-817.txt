https://github.com/canonical/cloud-init/commit/13606a12

=== Begin SRU Template ===
[Impact]
SSH headers and footers are no longer shown when output of SSH host keys and/or
SSH fingerprints are disabled.

[Test Case]
There is an upstream test for this bug:
https://github.com/canonical/cloud-init/blob/master/tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist

=== Bionic ===
============================= test session starts ==============================
platform linux -- Python 3.5.10, pytest-6.1.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/james/cloud-init-tests, configfile: tox.ini
plugins: cov-2.11.1
collected 2 items

tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_header_excluded Detected image: image_id=bionic os=ubuntu release=bionic

-------------------------------- live log setup --------------------------------
2021-05-14 20:45:47 INFO      integration_testing:clouds.py:88 Detected image: image_id=bionic os=ubuntu release=bionic
Detected image: image_id=bionic os=ubuntu release=bionic
2021-05-14 20:45:47 INFO      integration_testing:clouds.py:88 Detected image: image_id=bionic os=ubuntu release=bionic
Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=bionic
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
2021-05-14 20:45:53 INFO      integration_testing:clouds.py:129 Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=bionic
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
Setting up environment for lxd_vm
2021-05-14 20:45:53 INFO      integration_testing:conftest.py:156 Setting up environment for lxd_vm
Launching instance with launch_kwargs:
image_id=ubuntu:4fb318cb190fc599b788584d5088c8a64bb32bbc5d8a429cac60263bddf4c7f5
user_data=None
2021-05-14 20:45:53 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
image_id=ubuntu:4fb318cb190fc599b788584d5088c8a64bb32bbc5d8a429cac60263bddf4c7f5
user_data=None
The profile named pycloudlib-vm-bionic-v2 already exists
['lxc', 'init', 'ubuntu:4fb318cb190fc599b788584d5088c8a64bb32bbc5d8a429cac60263bddf4c7f5', '--profile', 'pycloudlib-vm-bionic-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--vm']
2021-05-14 20:46:46 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 20:47:10 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.194
Retrying SSH connection to ubuntu@10.37.179.194:22 (576s left)
2021-05-14 20:47:11 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.194
Retrying SSH connection to ubuntu@10.37.179.194:22 (574s left)
2021-05-14 20:47:12 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.194
Retrying SSH connection to ubuntu@10.37.179.194:22 (573s left)
2021-05-14 20:47:13 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.194
Retrying SSH connection to ubuntu@10.37.179.194:22 (572s left)
2021-05-14 20:47:14 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_7.6p1)
2021-05-14 20:47:14 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 20:47:15 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=evident-ant)
2021-05-14 20:47:18 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=evident-ant)
2021-05-14 20:47:18 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
2021-05-14 20:47:18 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_7.6p1)
2021-05-14 20:47:18 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 20:47:18 ERROR     paramiko.transport:transport.py:1819 Socket exception: Connection reset by peer (104)
2021-05-14 20:47:20 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.194
Retrying SSH connection to ubuntu@10.37.179.194:22 (598s left)
2021-05-14 20:47:52 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_7.6p1)
2021-05-14 20:47:52 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~18.04.2
2021-05-14 20:47:53 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~18.04.2
2021-05-14 20:47:53 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210512
2021-05-14 20:47:53 INFO      integration_testing:clouds.py:183 image serial: 20210512
Installing proposed image
2021-05-14 20:47:53 INFO      integration_testing:instances.py:144 Installing proposed image
2021-05-14 20:47:53 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'echo deb "http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-proposed main" | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init'
2021-05-14 20:48:07 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init -v'
Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~18.04.1
2021-05-14 20:48:08 INFO      integration_testing:instances.py:136 Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~18.04.1
2021-05-14 20:48:08 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 20:48:08 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 20:48:08 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 20:48:08 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 20:48:08 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 20:48:09 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
Created new image: local:evident-ant-snapshot
2021-05-14 20:49:30 INFO      integration_testing:instances.py:113 Created new image: local:evident-ant-snapshot
Done with environment setup
2021-05-14 20:49:31 INFO      integration_testing:conftest.py:162 Done with environment setup
Launching instance with launch_kwargs:
image_id=local:evident-ant-snapshot
user_data=#cloud-config
ssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]

2021-05-14 20:49:31 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
image_id=local:evident-ant-snapshot
user_data=#cloud-config
ssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]

['lxc', 'init', 'local:evident-ant-snapshot', '--profile', 'pycloudlib-vm-bionic-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--config', 'user.user-data=#cloud-config\nssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]\n', '--vm']
2021-05-14 20:50:41 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 20:51:29 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.175
Retrying SSH connection to ubuntu@10.37.179.175:22 (552s left)
2021-05-14 20:51:31 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.175
Retrying SSH connection to ubuntu@10.37.179.175:22 (550s left)
2021-05-14 20:51:32 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_7.6p1)
2021-05-14 20:51:32 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 20:51:33 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=rested-insect)
2021-05-14 20:51:37 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=rested-insect)
2021-05-14 20:51:37 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~18.04.1
2021-05-14 20:51:37 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~18.04.1
2021-05-14 20:51:37 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210512
2021-05-14 20:51:37 INFO      integration_testing:clouds.py:183 image serial: 20210512
-------------------------------- live log call ---------------------------------
2021-05-14 20:51:37 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/syslog'
PASSED
tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_footer_excluded Detected image: image_id=bionic os=ubuntu release=bionic

-------------------------------- live log setup --------------------------------
2021-05-14 20:51:38 INFO      integration_testing:clouds.py:88 Detected image: image_id=bionic os=ubuntu release=bionic
-------------------------------- live log call ---------------------------------
2021-05-14 20:51:38 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/syslog'
PASSED
------------------------------ live log teardown -------------------------------
2021-05-14 20:51:38 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init collect-logs -u -t /var/tmp/cloud-init.tar.gz'
Writing logs to /tmp/cloud_init_test_logs/210514154547/tests/integration_tests/modules/test_keys_to_console/TestAllKeysToConsoleBlacklist
2021-05-14 20:51:38 INFO      integration_testing:conftest.py:192 Writing logs to /tmp/cloud_init_test_logs/210514154547/tests/integration_tests/modules/test_keys_to_console/TestAllKeysToConsoleBlacklist
2021-05-14 20:51:38 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'cp /var/tmp/cloud-init.tar.gz /var/tmp/dbb15a1f-1f80-43c7-aebe-e593b9b146e3.tmp'
2021-05-14 20:51:38 INFO      paramiko.transport.sftp:sftp.py:158 [chan 8] Opened sftp connection (server version 3)
Deleting snapshot image created for this testrun: local:evident-ant-snapshot
2021-05-14 20:51:39 INFO      integration_testing:clouds.py:204 Deleting snapshot image created for this testrun: local:evident-ant-snapshot
------------------------------ live log logreport ------------------------------
2021-05-14 20:51:39 INFO      paramiko.transport.sftp:sftp.py:158 [chan 8] sftp session closed.


=============================== warnings summary ===============================
../envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8
  /home/james/envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8: CryptographyDeprecationWarning: Python 3.5 support will be dropped in the next release of cryptography. Please upgrade your Python.
    from cryptography.hazmat.primitives.asymmetric.utils import (

tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_header_excluded
  /home/james/envs/cloud-init/lib/python3.5/site-packages/simplestreams/mirrors/__init__.py:207: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
    self.prefix, path)

-- Docs: https://docs.pytest.org/en/stable/warnings.html
================== 2 passed, 2 warnings in 352.25s (0:05:52) ===================


=== Focal ===
============================= test session starts ==============================
platform linux -- Python 3.5.10, pytest-6.1.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/james/cloud-init-tests, configfile: tox.ini
plugins: cov-2.11.1
collected 2 items

tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_header_excluded Detected image: image_id=focal os=ubuntu release=focal

-------------------------------- live log setup --------------------------------
2021-05-14 21:09:48 INFO      integration_testing:clouds.py:88 Detected image: image_id=focal os=ubuntu release=focal
Detected image: image_id=focal os=ubuntu release=focal
2021-05-14 21:09:48 INFO      integration_testing:clouds.py:88 Detected image: image_id=focal os=ubuntu release=focal
Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=focal
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
2021-05-14 21:09:55 INFO      integration_testing:clouds.py:129 Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=focal
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
Setting up environment for lxd_vm
2021-05-14 21:09:55 INFO      integration_testing:conftest.py:156 Setting up environment for lxd_vm
Launching instance with launch_kwargs:
user_data=None
image_id=ubuntu:f217de8a505d919f42cac6a898ac66fdf582b8ccc092d73189b46101615f3612
2021-05-14 21:09:55 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
user_data=None
image_id=ubuntu:f217de8a505d919f42cac6a898ac66fdf582b8ccc092d73189b46101615f3612
The profile named pycloudlib-vm-focal-v2 already exists
['lxc', 'init', 'ubuntu:f217de8a505d919f42cac6a898ac66fdf582b8ccc092d73189b46101615f3612', '--profile', 'pycloudlib-vm-focal-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--vm']
2021-05-14 21:10:58 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 21:11:19 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.17
Retrying SSH connection to ubuntu@10.37.179.17:22 (578s left)
2021-05-14 21:11:20 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.17
Retrying SSH connection to ubuntu@10.37.179.17:22 (577s left)
2021-05-14 21:11:22 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.17
Retrying SSH connection to ubuntu@10.37.179.17:22 (576s left)
2021-05-14 21:11:23 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.17
Retrying SSH connection to ubuntu@10.37.179.17:22 (574s left)
2021-05-14 21:11:25 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.17
Retrying SSH connection to ubuntu@10.37.179.17:22 (573s left)
2021-05-14 21:11:26 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.17
Retrying SSH connection to ubuntu@10.37.179.17:22 (571s left)
2021-05-14 21:11:28 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.17
Retrying SSH connection to ubuntu@10.37.179.17:22 (570s left)
2021-05-14 21:11:29 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.2p1)
2021-05-14 21:11:29 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 21:11:30 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=adapting-goat)
2021-05-14 21:11:31 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=adapting-goat)
2021-05-14 21:11:31 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~20.04.2
2021-05-14 21:11:31 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~20.04.2
2021-05-14 21:11:31 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210510
2021-05-14 21:11:31 INFO      integration_testing:clouds.py:183 image serial: 20210510
Installing proposed image
2021-05-14 21:11:31 INFO      integration_testing:instances.py:144 Installing proposed image
2021-05-14 21:11:31 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'echo deb "http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-proposed main" | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init'
2021-05-14 21:12:11 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init -v'
Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~20.04.1
2021-05-14 21:12:11 INFO      integration_testing:instances.py:136 Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~20.04.1
2021-05-14 21:12:11 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:12:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 21:12:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:12:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 21:12:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:12:12 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
Created new image: local:adapting-goat-snapshot
2021-05-14 21:13:59 INFO      integration_testing:instances.py:113 Created new image: local:adapting-goat-snapshot
Done with environment setup
2021-05-14 21:13:59 INFO      integration_testing:conftest.py:162 Done with environment setup
Launching instance with launch_kwargs:
user_data=#cloud-config
ssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]

image_id=local:adapting-goat-snapshot
2021-05-14 21:13:59 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
user_data=#cloud-config
ssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]

image_id=local:adapting-goat-snapshot
['lxc', 'init', 'local:adapting-goat-snapshot', '--profile', 'pycloudlib-vm-focal-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--config', 'user.user-data=#cloud-config\nssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]\n', '--vm']
2021-05-14 21:15:47 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 21:16:11 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.94
Retrying SSH connection to ubuntu@10.37.179.94:22 (575s left)
2021-05-14 21:16:13 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.94
Retrying SSH connection to ubuntu@10.37.179.94:22 (573s left)
2021-05-14 21:16:15 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.2p1)
2021-05-14 21:16:16 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 21:16:18 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=summary-catfish)
2021-05-14 21:16:21 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=summary-catfish)
2021-05-14 21:16:21 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~20.04.1
2021-05-14 21:16:21 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~20.04.1
2021-05-14 21:16:21 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210510
2021-05-14 21:16:21 INFO      integration_testing:clouds.py:183 image serial: 20210510
-------------------------------- live log call ---------------------------------
2021-05-14 21:16:21 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/syslog'
PASSED
tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_footer_excluded Detected image: image_id=focal os=ubuntu release=focal

-------------------------------- live log setup --------------------------------
2021-05-14 21:16:21 INFO      integration_testing:clouds.py:88 Detected image: image_id=focal os=ubuntu release=focal
-------------------------------- live log call ---------------------------------
2021-05-14 21:16:21 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/syslog'
PASSED
------------------------------ live log teardown -------------------------------
2021-05-14 21:16:21 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init collect-logs -u -t /var/tmp/cloud-init.tar.gz'
Writing logs to /tmp/cloud_init_test_logs/210514160948/tests/integration_tests/modules/test_keys_to_console/TestAllKeysToConsoleBlacklist
2021-05-14 21:16:22 INFO      integration_testing:conftest.py:192 Writing logs to /tmp/cloud_init_test_logs/210514160948/tests/integration_tests/modules/test_keys_to_console/TestAllKeysToConsoleBlacklist
2021-05-14 21:16:22 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'cp /var/tmp/cloud-init.tar.gz /var/tmp/18406337-6875-4eb9-b4ea-19e92b49c0be.tmp'
2021-05-14 21:16:22 INFO      paramiko.transport.sftp:sftp.py:158 [chan 8] Opened sftp connection (server version 3)
Deleting snapshot image created for this testrun: local:adapting-goat-snapshot
2021-05-14 21:16:22 INFO      integration_testing:clouds.py:204 Deleting snapshot image created for this testrun: local:adapting-goat-snapshot
------------------------------ live log logreport ------------------------------
2021-05-14 21:16:23 INFO      paramiko.transport.sftp:sftp.py:158 [chan 8] sftp session closed.


=============================== warnings summary ===============================
../envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8
  /home/james/envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8: CryptographyDeprecationWarning: Python 3.5 support will be dropped in the next release of cryptography. Please upgrade your Python.
    from cryptography.hazmat.primitives.asymmetric.utils import (

tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_header_excluded
  /home/james/envs/cloud-init/lib/python3.5/site-packages/simplestreams/mirrors/__init__.py:207: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
    self.prefix, path)

-- Docs: https://docs.pytest.org/en/stable/warnings.html
================== 2 passed, 2 warnings in 394.33s (0:06:34) ===================


=== Groovy ===
============================= test session starts ==============================
platform linux -- Python 3.5.10, pytest-6.1.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/james/cloud-init-tests, configfile: tox.ini
plugins: cov-2.11.1
collected 2 items

tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_header_excluded Detected image: image_id=groovy os=ubuntu release=groovy

-------------------------------- live log setup --------------------------------
2021-05-14 21:31:24 INFO      integration_testing:clouds.py:88 Detected image: image_id=groovy os=ubuntu release=groovy
Detected image: image_id=groovy os=ubuntu release=groovy
2021-05-14 21:31:24 INFO      integration_testing:clouds.py:88 Detected image: image_id=groovy os=ubuntu release=groovy
Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=groovy
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
2021-05-14 21:31:30 INFO      integration_testing:clouds.py:129 Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=groovy
PLATFORM=lxd_vm
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
Setting up environment for lxd_vm
2021-05-14 21:31:30 INFO      integration_testing:conftest.py:156 Setting up environment for lxd_vm
Launching instance with launch_kwargs:
image_id=ubuntu:982a39044cfe9c5372e65bb762453f2a34b339e26cef3d817b59f46c6e55c2b0
user_data=None
2021-05-14 21:31:30 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
image_id=ubuntu:982a39044cfe9c5372e65bb762453f2a34b339e26cef3d817b59f46c6e55c2b0
user_data=None
The profile named pycloudlib-vm-groovy-v2 already exists
['lxc', 'init', 'ubuntu:982a39044cfe9c5372e65bb762453f2a34b339e26cef3d817b59f46c6e55c2b0', '--profile', 'pycloudlib-vm-groovy-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--vm']
2021-05-14 21:31:33 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 21:31:54 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.112
Retrying SSH connection to ubuntu@10.37.179.112:22 (578s left)
2021-05-14 21:31:56 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.112
Retrying SSH connection to ubuntu@10.37.179.112:22 (577s left)
2021-05-14 21:31:57 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.112
Retrying SSH connection to ubuntu@10.37.179.112:22 (576s left)
2021-05-14 21:31:59 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.112
Retrying SSH connection to ubuntu@10.37.179.112:22 (574s left)
2021-05-14 21:32:00 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.3p1)
2021-05-14 21:32:00 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 21:32:02 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=oriented-koala)
2021-05-14 21:32:05 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=oriented-koala)
2021-05-14 21:32:05 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~20.10.2
2021-05-14 21:32:05 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu1~20.10.2
2021-05-14 21:32:05 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210511.1
2021-05-14 21:32:06 INFO      integration_testing:clouds.py:183 image serial: 20210511.1
Installing proposed image
2021-05-14 21:32:06 INFO      integration_testing:instances.py:144 Installing proposed image
2021-05-14 21:32:06 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'echo deb "http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-proposed main" | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init'
2021-05-14 21:32:21 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init -v'
Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~20.10.1
2021-05-14 21:32:21 INFO      integration_testing:instances.py:136 Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~20.10.1
2021-05-14 21:32:21 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:32:21 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 21:32:21 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:32:21 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-14 21:32:21 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-14 21:32:22 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
Created new image: local:oriented-koala-snapshot
2021-05-14 21:33:51 INFO      integration_testing:instances.py:113 Created new image: local:oriented-koala-snapshot
Done with environment setup
2021-05-14 21:33:51 INFO      integration_testing:conftest.py:162 Done with environment setup
Launching instance with launch_kwargs:
image_id=local:oriented-koala-snapshot
user_data=#cloud-config
ssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]

2021-05-14 21:33:51 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
image_id=local:oriented-koala-snapshot
user_data=#cloud-config
ssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]

['lxc', 'init', 'local:oriented-koala-snapshot', '--profile', 'pycloudlib-vm-groovy-v2', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--config', 'user.user-data=#cloud-config\nssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]\n', '--vm']
2021-05-14 21:34:54 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-14 21:35:14 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.166
Retrying SSH connection to ubuntu@10.37.179.166:22 (580s left)
2021-05-14 21:35:15 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.37.179.166
Retrying SSH connection to ubuntu@10.37.179.166:22 (578s left)
2021-05-14 21:35:17 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.3p1)
2021-05-14 21:35:17 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-14 21:35:19 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=capital-dingo)
2021-05-14 21:35:22 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=capital-dingo)
2021-05-14 21:35:22 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~20.10.1
2021-05-14 21:35:22 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~20.10.1
2021-05-14 21:35:22 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210511.1
2021-05-14 21:35:22 INFO      integration_testing:clouds.py:183 image serial: 20210511.1
-------------------------------- live log call ---------------------------------
2021-05-14 21:35:22 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/syslog'
PASSED
tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_footer_excluded Detected image: image_id=groovy os=ubuntu release=groovy

-------------------------------- live log setup --------------------------------
2021-05-14 21:35:22 INFO      integration_testing:clouds.py:88 Detected image: image_id=groovy os=ubuntu release=groovy
-------------------------------- live log call ---------------------------------
2021-05-14 21:35:22 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/syslog'
PASSED
------------------------------ live log teardown -------------------------------
2021-05-14 21:35:22 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init collect-logs -u -t /var/tmp/cloud-init.tar.gz'
Writing logs to /tmp/cloud_init_test_logs/210514163124/tests/integration_tests/modules/test_keys_to_console/TestAllKeysToConsoleBlacklist
2021-05-14 21:35:23 INFO      integration_testing:conftest.py:192 Writing logs to /tmp/cloud_init_test_logs/210514163124/tests/integration_tests/modules/test_keys_to_console/TestAllKeysToConsoleBlacklist
2021-05-14 21:35:23 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'cp /var/tmp/cloud-init.tar.gz /var/tmp/7c91bc06-4e2a-471c-859c-64c5e575f3a2.tmp'
2021-05-14 21:35:23 INFO      paramiko.transport.sftp:sftp.py:158 [chan 8] Opened sftp connection (server version 3)
Deleting snapshot image created for this testrun: local:oriented-koala-snapshot
2021-05-14 21:35:23 INFO      integration_testing:clouds.py:204 Deleting snapshot image created for this testrun: local:oriented-koala-snapshot
------------------------------ live log logreport ------------------------------
2021-05-14 21:35:23 INFO      paramiko.transport.sftp:sftp.py:158 [chan 8] sftp session closed.


=============================== warnings summary ===============================
../envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8
  /home/james/envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8: CryptographyDeprecationWarning: Python 3.5 support will be dropped in the next release of cryptography. Please upgrade your Python.
    from cryptography.hazmat.primitives.asymmetric.utils import (

tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_header_excluded
  /home/james/envs/cloud-init/lib/python3.5/site-packages/simplestreams/mirrors/__init__.py:207: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
    self.prefix, path)

-- Docs: https://docs.pytest.org/en/stable/warnings.html
================== 2 passed, 2 warnings in 239.16s (0:03:59) ===================


=== Hirsute ===
============================= test session starts ==============================
platform linux -- Python 3.5.10, pytest-6.1.2, py-1.10.0, pluggy-0.13.1
rootdir: /home/james/cloud-init-tests, configfile: tox.ini
plugins: cov-2.11.1
collected 2 items

tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_header_excluded Detected image: image_id=hirsute os=ubuntu release=hirsute

-------------------------------- live log setup --------------------------------
2021-05-17 16:56:28 INFO      integration_testing:clouds.py:88 Detected image: image_id=hirsute os=ubuntu release=hirsute
Detected image: image_id=hirsute os=ubuntu release=hirsute
2021-05-17 16:56:28 INFO      integration_testing:clouds.py:88 Detected image: image_id=hirsute os=ubuntu release=hirsute
Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=hirsute
PLATFORM=lxd_container
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
2021-05-17 16:56:34 INFO      integration_testing:clouds.py:129 Settings:
CLOUD_INIT_SOURCE=PROPOSED
COLLECT_LOGS=ALWAYS
EXISTING_INSTANCE_ID=None
INSTANCE_TYPE=None
KEEP_IMAGE=False
KEEP_INSTANCE=False
KEYPAIR_NAME=None
LOCAL_LOG_PATH=/tmp/cloud_init_test_logs
OPENSTACK_NETWORK=falcojr_admin_net
OS_IMAGE=hirsute
PLATFORM=lxd_container
PUBLIC_SSH_KEY=None
RUN_UNSTABLE=False
Setting up environment for lxd_container
2021-05-17 16:56:34 INFO      integration_testing:conftest.py:156 Setting up environment for lxd_container
Launching instance with launch_kwargs:
image_id=ubuntu:8adad13e1e1185af6ad9efc0e8e9129cdd9d11d04a2751c140ecb94825048ad7
user_data=None
2021-05-17 16:56:34 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
image_id=ubuntu:8adad13e1e1185af6ad9efc0e8e9129cdd9d11d04a2751c140ecb94825048ad7
user_data=None
['lxc', 'init', 'ubuntu:8adad13e1e1185af6ad9efc0e8e9129cdd9d11d04a2751c140ecb94825048ad7', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n']
2021-05-17 16:56:59 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-17 16:57:01 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.253.153.111
Retrying SSH connection to ubuntu@10.253.153.111:22 (597s left)
2021-05-17 16:57:02 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.4p1)
2021-05-17 16:57:02 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-17 16:57:03 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=polished-starling)
2021-05-17 16:57:12 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=polished-starling)
2021-05-17 16:57:12 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu3
2021-05-17 16:57:13 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.1-19-gbad84ad4-0ubuntu3
2021-05-17 16:57:13 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210513
2021-05-17 16:57:13 INFO      integration_testing:clouds.py:183 image serial: 20210513
Installing proposed image
2021-05-17 16:57:13 INFO      integration_testing:instances.py:144 Installing proposed image
2021-05-17 16:57:13 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'echo deb "http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-proposed main" | tee /etc/apt/sources.list.d/proposed.list
apt-get update -q
apt-get install -qy cloud-init'
2021-05-17 16:57:28 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init -v'
Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~21.04.1
2021-05-17 16:57:29 INFO      integration_testing:instances.py:136 Installed cloud-init version: 21.2-3-g899bfaa9-0ubuntu2~21.04.1
2021-05-17 16:57:29 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-17 16:57:29 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-17 16:57:29 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-17 16:57:29 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
2021-05-17 16:57:29 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo cloud-init clean --logs'
2021-05-17 16:57:30 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'sudo rm -rf /var/log/syslog'
Created new image: local:polished-starling-snapshot
2021-05-17 16:58:16 INFO      integration_testing:instances.py:113 Created new image: local:polished-starling-snapshot
Done with environment setup
2021-05-17 16:58:16 INFO      integration_testing:conftest.py:162 Done with environment setup
Launching instance with launch_kwargs:
image_id=local:polished-starling-snapshot
user_data=#cloud-config
ssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]

2021-05-17 16:58:16 INFO      integration_testing:clouds.py:168 Launching instance with launch_kwargs:
image_id=local:polished-starling-snapshot
user_data=#cloud-config
ssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]

['lxc', 'init', 'local:polished-starling-snapshot', '--config', 'user.meta-data=public-keys: ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJMS8gdKw0kA1PDwAVkURrxgjbAgWVeiBq+VSOI1jFLafONDwkc0ZVriZofmCZ1BVjixCA6kqVQsmA88Av7eeI3jGvy4fwX+TKhDQk28rRC9mNz8nBLfB+gp3wfcgFJrVeekhjV+fgxiyq1wJC4WcJZfXKdXvsNTBzhd2RNZAsyKyRKBRahv57/KJjXozS94p83l0qq/gi6pYYBTTkLz65SiyVCUpkddgXDPfxEXqjsx6ha3VCdoKBdRgh3p2toADzcYafyqxDMPtfLJE+BofSA4Gi9YQAMhshdk4tzI+KYcq07cd8AtreXpVyZLC3r7cfe4m2IK7UvVSbTItYoUItN255P1M09eLQNlbbrJwnxuX3IUwxBkYZhVUIaEOQreWTnc+tg20ZK3olUzNWcJBurpeT5i6Hg/QoRrQSanVLFx8hff4l1V9Yxb23txlv9e2Pzh0i/0YVmrVlQxuen/5YyWNm553D1EfH8fEon3xVAqrbC8NS63GaP0QhGo7rlYs= james@newt\n', '--config', 'user.user-data=#cloud-config\nssh_fp_console_blacklist: [ssh-dsa, ssh-ecdsa, ssh-ed25519, ssh-rsa, ssh-dss, ecdsa-sha2-nistp256]\n']
2021-05-17 16:58:31 INFO      pycloudlib.instance:instance.py:165 executing: sh -c whoami
2021-05-17 16:58:33 INFO      pycloudlib.instance:instance.py:343 [Errno None] Unable to connect to port 22 on 10.253.153.139
Retrying SSH connection to ubuntu@10.253.153.139:22 (597s left)
2021-05-17 16:58:34 INFO      paramiko.transport:transport.py:1819 Connected (version 2.0, client OpenSSH_8.4p1)
2021-05-17 16:58:34 INFO      paramiko.transport:transport.py:1819 Authentication (publickey) successful!
2021-05-17 16:58:35 INFO      pycloudlib.instance:instance.py:165 executing: cloud-init status --wait --long
Launched instance: LXDInstance(name=holy-guppy)
2021-05-17 16:58:39 INFO      integration_testing:clouds.py:173 Launched instance: LXDInstance(name=holy-guppy)
2021-05-17 16:58:39 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init --version'
cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~21.04.1
2021-05-17 16:58:39 INFO      integration_testing:clouds.py:179 cloud-init version: /usr/bin/cloud-init 21.2-3-g899bfaa9-0ubuntu2~21.04.1
2021-05-17 16:58:39 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'grep serial /etc/cloud/build.info'
image serial: 20210513
2021-05-17 16:58:39 INFO      integration_testing:clouds.py:183 image serial: 20210513
-------------------------------- live log call ---------------------------------
2021-05-17 16:58:39 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/syslog'
PASSED
tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_footer_excluded Detected image: image_id=hirsute os=ubuntu release=hirsute

-------------------------------- live log setup --------------------------------
2021-05-17 16:58:39 INFO      integration_testing:clouds.py:88 Detected image: image_id=hirsute os=ubuntu release=hirsute
-------------------------------- live log call ---------------------------------
2021-05-17 16:58:39 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cat /var/log/syslog'
PASSED
------------------------------ live log teardown -------------------------------
2021-05-17 16:58:39 INFO      pycloudlib.instance:instance.py:165 executing: sudo -- sh -c 'cloud-init collect-logs -u -t /var/tmp/cloud-init.tar.gz'
Writing logs to /tmp/cloud_init_test_logs/210517115628/tests/integration_tests/modules/test_keys_to_console/TestAllKeysToConsoleBlacklist
2021-05-17 16:58:40 INFO      integration_testing:conftest.py:192 Writing logs to /tmp/cloud_init_test_logs/210517115628/tests/integration_tests/modules/test_keys_to_console/TestAllKeysToConsoleBlacklist
2021-05-17 16:58:40 INFO      pycloudlib.instance:instance.py:165 executing: sh -c 'cp /var/tmp/cloud-init.tar.gz /var/tmp/281d6f22-e956-4d5a-8ca2-b887188606e5.tmp'
2021-05-17 16:58:40 INFO      paramiko.transport.sftp:sftp.py:158 [chan 8] Opened sftp connection (server version 3)
Deleting snapshot image created for this testrun: local:polished-starling-snapshot
2021-05-17 16:58:46 INFO      integration_testing:clouds.py:204 Deleting snapshot image created for this testrun: local:polished-starling-snapshot


=============================== warnings summary ===============================
../envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8
  /home/james/envs/cloud-init/lib/python3.5/site-packages/jwt/utils.py:8: CryptographyDeprecationWarning: Python 3.5 support will be dropped in the next release of cryptography. Please upgrade your Python.
    from cryptography.hazmat.primitives.asymmetric.utils import (

tests/integration_tests/modules/test_keys_to_console.py::TestAllKeysToConsoleBlacklist::test_header_excluded
  /home/james/envs/cloud-init/lib/python3.5/site-packages/simplestreams/mirrors/__init__.py:207: DeprecationWarning: The 'warn' method is deprecated, use 'warning' instead
    self.prefix, path)

-- Docs: https://docs.pytest.org/en/stable/warnings.html
================== 2 passed, 2 warnings in 138.25s (0:02:18) ===================


[Regression Potential]
If a bug was introduced, SSH headers, footers, keys, or fingerprints could
be excluded from logs.
